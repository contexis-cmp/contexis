# Workflow State Configuration: {{ .Name }}
# Generated by CMP Framework on {{ .CreatedDate }}

workflow_name: "{{ .Name }}"
version: "{{ .Version }}"
description: "State management configuration for {{ .Name }} workflow"

# State Persistence Configuration
persistence:
  enabled: {{ .StatePersistence }}
  storage_type: "file_based"
  storage_path: "memory/{{ .Name }}/workflow_state"
  format: "json"
  compression: true
  encryption: true

# State Management
state_management:
  checkpoint_frequency: 30
  checkpoint_retention: 7
  state_cleanup: "after_completion"
  state_backup: true
  state_restore: true

# Workflow State Structure
state_structure:
  workflow_info:
    name: "{{ .Name }}"
    version: "{{ .Version }}"
    created_date: "{{ .CreatedDate }}"
    last_modified: "{{ .LastModified }}"
    status: "initialized"
    current_step: ""
    completed_steps: []
    failed_steps: []
    total_steps: {{ len .StepsConfig }}
  
  execution_state:
    start_time: ""
    end_time: ""
    duration: 0
    progress: 0.0
    status: "pending"
    error_count: 0
    retry_count: 0
  
  step_states:
{{- range $index, $step := .StepsConfig }}
    {{ $step.Name }}:
      status: "pending"
      start_time: ""
      end_time: ""
      duration: 0
      attempts: 0
      max_attempts: {{ $step.RetryAttempts }}
      error_message: ""
      input_data: {}
      output_data: {}
      dependencies_met: {{ if gt (len $step.Dependencies) 0 }}false{{ else }}true{{ end }}
      parallel_execution: {{ $step.Parallel }}
{{- end }}
  
  resource_usage:
    cpu_usage: 0.0
    memory_usage: 0.0
    storage_usage: 0.0
    network_usage: 0.0
    peak_usage:
      cpu: 0.0
      memory: 0.0
      storage: 0.0
      network: 0.0
  
  error_log:
    errors: []
    warnings: []
    info_messages: []
  
  performance_metrics:
    step_execution_times: {}
    resource_utilization: {}
    throughput: 0.0
    latency: 0.0

# State Operations
operations:
  save_state:
    frequency: "on_step_completion"
    triggers:
      - "step_success"
      - "step_failure"
      - "workflow_pause"
      - "manual_checkpoint"
  
  load_state:
    triggers:
      - "workflow_resume"
      - "error_recovery"
      - "manual_restore"
  
  cleanup_state:
    triggers:
      - "workflow_completion"
      - "workflow_failure"
      - "manual_cleanup"
    retention_period: "7_days"

# State Validation
validation:
  state_integrity: true
  dependency_validation: true
  resource_validation: true
  data_consistency: true

# State Recovery
recovery:
  automatic_recovery: true
  recovery_strategies:
    - "step_retry"
    - "dependency_rebuild"
    - "state_restore"
    - "workflow_restart"
  max_recovery_attempts: 3

# Monitoring and Alerting
monitoring:
  state_monitoring: true
  performance_monitoring: true
  resource_monitoring: true
  alert_thresholds:
    state_corruption: "immediate"
    resource_exhaustion: "80_percent"
    performance_degradation: "50_percent"
