<!-- Code generated by gomarkdoc. DO NOT EDIT -->

# cli

```go
import "github.com/contexis-cmp/contexis/src/cli"
```

Package main provides the Contexis CMP Framework CLI application.

The Contexis CLI is a Rails\-inspired command\-line interface for building reproducible AI applications using the Context\-Memory\-Prompt \(CMP\) architecture. It provides commands for project initialization, component generation, testing, and deployment of AI applications.

Key Features:

- Local\-first development with out\-of\-the\-box local models
- Component generation \(RAG, agents, workflows\)
- Memory management and vector search
- Drift detection and testing
- Production migration tools

Example Usage:

```
# Initialize a new project
ctx init my-ai-app

# Generate a RAG component
ctx generate rag CustomerDocs

# Run tests with drift detection
ctx test --drift-detection

# Start development server
ctx serve --addr :8000
```

## Index

- [type ConfigError](<#ConfigError>)
  - [func \(e ConfigError\) Error\(\) string](<#ConfigError.Error>)
- [type ProjectError](<#ProjectError>)
  - [func \(e ProjectError\) Error\(\) string](<#ProjectError.Error>)
- [type SecurityError](<#SecurityError>)
  - [func \(e SecurityError\) Error\(\) string](<#SecurityError.Error>)
- [type ValidationError](<#ValidationError>)
  - [func \(e ValidationError\) Error\(\) string](<#ValidationError.Error>)


<a name="ConfigError"></a>
## type [ConfigError](<https://github.com/contexis-cmp/contexis/blob/main/src/cli/errors.go#L8-L11>)

Structured errors for user\-facing CLI

```go
type ConfigError struct {
    Path   string
    Reason string
}
```

<a name="ConfigError.Error"></a>
### func \(ConfigError\) [Error](<https://github.com/contexis-cmp/contexis/blob/main/src/cli/errors.go#L13>)

```go
func (e ConfigError) Error() string
```



<a name="ProjectError"></a>
## type [ProjectError](<https://github.com/contexis-cmp/contexis/blob/main/src/cli/errors.go#L27-L31>)



```go
type ProjectError struct {
    Name   string
    Action string
    Reason string
}
```

<a name="ProjectError.Error"></a>
### func \(ProjectError\) [Error](<https://github.com/contexis-cmp/contexis/blob/main/src/cli/errors.go#L33>)

```go
func (e ProjectError) Error() string
```



<a name="SecurityError"></a>
## type [SecurityError](<https://github.com/contexis-cmp/contexis/blob/main/src/cli/errors.go#L37-L40>)



```go
type SecurityError struct {
    Operation string
    Reason    string
}
```

<a name="SecurityError.Error"></a>
### func \(SecurityError\) [Error](<https://github.com/contexis-cmp/contexis/blob/main/src/cli/errors.go#L42>)

```go
func (e SecurityError) Error() string
```



<a name="ValidationError"></a>
## type [ValidationError](<https://github.com/contexis-cmp/contexis/blob/main/src/cli/errors.go#L17-L21>)



```go
type ValidationError struct {
    Field   string
    Value   string
    Message string
}
```

<a name="ValidationError.Error"></a>
### func \(ValidationError\) [Error](<https://github.com/contexis-cmp/contexis/blob/main/src/cli/errors.go#L23>)

```go
func (e ValidationError) Error() string
```



# commands

```go
import "github.com/contexis-cmp/contexis/src/cli/commands"
```

## Index

- [Variables](<#variables>)
- [func GenerateAgent\(ctx context.Context, name, tools, memory string\) error](<#GenerateAgent>)
- [func GeneratePlugin\(\_ context.Context, name string\) error](<#GeneratePlugin>)
- [func GenerateWorkflow\(ctx context.Context, name, steps string\) error](<#GenerateWorkflow>)
- [func GetAgentCommand\(\) \*cobra.Command](<#GetAgentCommand>)
- [func GetBuildCommand\(\) \*cobra.Command](<#GetBuildCommand>)
- [func GetContextCommand\(projectRoot string\) \*cobra.Command](<#GetContextCommand>)
- [func GetDeployCommand\(\) \*cobra.Command](<#GetDeployCommand>)
- [func GetGenerateCommand\(\) \*cobra.Command](<#GetGenerateCommand>)
- [func GetHFCommand\(\) \*cobra.Command](<#GetHFCommand>)
- [func GetLockCommand\(\) \*cobra.Command](<#GetLockCommand>)
- [func GetMemoryCommand\(\) \*cobra.Command](<#GetMemoryCommand>)
- [func GetMigrateCommand\(\) \*cobra.Command](<#GetMigrateCommand>)
- [func GetModelsCommand\(\) \*cobra.Command](<#GetModelsCommand>)
- [func GetPluginCommand\(projectRoot string\) \*cobra.Command](<#GetPluginCommand>)
- [func GetPromptCommand\(\) \*cobra.Command](<#GetPromptCommand>)
- [func GetPromptLintCommand\(\) \*cobra.Command](<#GetPromptLintCommand>)
- [func GetRAGCommand\(\) \*cobra.Command](<#GetRAGCommand>)
- [func GetRootCommand\(\) \*cobra.Command](<#GetRootCommand>)
- [func GetRunCommand\(\) \*cobra.Command](<#GetRunCommand>)
- [func GetServeCommand\(\) \*cobra.Command](<#GetServeCommand>)
- [func GetSetupCommand\(\) \*cobra.Command](<#GetSetupCommand>)
- [func GetVersionCommand\(\) \*cobra.Command](<#GetVersionCommand>)
- [func GetWorkerCommand\(\) \*cobra.Command](<#GetWorkerCommand>)
- [func GetWorkflowCommand\(\) \*cobra.Command](<#GetWorkflowCommand>)
- [func RunDriftDetection\(ctx context.Context, projectRoot string, opts DriftOptions\) error](<#RunDriftDetection>)
- [func RunGoTests\(ctx context.Context, projectRoot string, opts TestRunOptions\) error](<#RunGoTests>)
- [func ValidateAgentConfig\(tools \[\]string, memory string\) error](<#ValidateAgentConfig>)
- [func ValidateWorkflowConfig\(steps \[\]string\) error](<#ValidateWorkflowConfig>)
- [type AgentConfig](<#AgentConfig>)
- [type DriftOptions](<#DriftOptions>)
- [type DriftRunReport](<#DriftRunReport>)
- [type DriftTestResult](<#DriftTestResult>)
- [type GoSuiteResult](<#GoSuiteResult>)
- [type GoTestsReport](<#GoTestsReport>)
- [type LockFile](<#LockFile>)
- [type ProjectConfig](<#ProjectConfig>)
- [type RAGConfig](<#RAGConfig>)
- [type ResourceLimits](<#ResourceLimits>)
- [type RunRequest](<#RunRequest>)
- [type RunResponse](<#RunResponse>)
- [type StepConfig](<#StepConfig>)
- [type TestRunOptions](<#TestRunOptions>)
- [type Tool](<#Tool>)
- [type WorkflowConfig](<#WorkflowConfig>)
- [type WorkflowStep](<#WorkflowStep>)


## Variables

<a name="GenerateCmd"></a>

```go
var GenerateCmd = &cobra.Command{
    Use:   "generate [type] [name]",
    Short: "Generate a new CMP component",
    Long: `Generate RAG systems, agents, workflows, or other CMP components using templates.

Available generators:
  rag       - Knowledge-based retrieval systems
  agent     - Conversational agents with tools
  workflow  - Multi-step AI processing pipelines
  plugin    - Scaffolds a plugin template

Examples:
  ctx generate rag CustomerDocs --db=sqlite --embeddings=openai
  ctx generate agent SupportBot --tools=web_search,database --memory=episodic
  ctx generate workflow ContentPipeline --steps=research,write,review`,
    Args: cobra.ExactArgs(2),
    RunE: runGenerate,
}
```

<a name="InitCmd"></a>

```go
var InitCmd = &cobra.Command{
    Use:   "init [project-name]",
    Short: "Initialize a new CMP project",
    Long: `Create a new Contexis project with the standard directory structure and configuration files.

This command will create:
- Project directory structure
- Configuration files
- Basic templates
- Test setup
- Documentation files`,
    Args: cobra.ExactArgs(1),
    RunE: runInit,
}
```

<a name="GenerateAgent"></a>
## func [GenerateAgent](<https://github.com/contexis-cmp/contexis/blob/main/src/cli/commands/agent_generator.go#L48>)

```go
func GenerateAgent(ctx context.Context, name, tools, memory string) error
```

generateAgent creates a conversational agent with tools and episodic memory

<a name="GeneratePlugin"></a>
## func [GeneratePlugin](<https://github.com/contexis-cmp/contexis/blob/main/src/cli/commands/generate_plugin.go#L11>)

```go
func GeneratePlugin(_ context.Context, name string) error
```

GeneratePlugin scaffolds a plugin from the template

<a name="GenerateWorkflow"></a>
## func [GenerateWorkflow](<https://github.com/contexis-cmp/contexis/blob/main/src/cli/commands/workflow_generator.go#L69>)

```go
func GenerateWorkflow(ctx context.Context, name, steps string) error
```

GenerateWorkflow creates a multi\-step AI processing pipeline

<a name="GetAgentCommand"></a>
## func [GetAgentCommand](<https://github.com/contexis-cmp/contexis/blob/main/src/cli/commands/cli_commands.go#L49>)

```go
func GetAgentCommand() *cobra.Command
```

GetAgentCommand returns the agent command

<a name="GetBuildCommand"></a>
## func [GetBuildCommand](<https://github.com/contexis-cmp/contexis/blob/main/src/cli/commands/build_commands.go#L13>)

```go
func GetBuildCommand() *cobra.Command
```

GetBuildCommand returns the build command to build and optionally push a Docker image

<a name="GetContextCommand"></a>
## func [GetContextCommand](<https://github.com/contexis-cmp/contexis/blob/main/src/cli/commands/context_commands.go#L13>)

```go
func GetContextCommand(projectRoot string) *cobra.Command
```

GetContextCommand returns the parent context command with subcommands.

<a name="GetDeployCommand"></a>
## func [GetDeployCommand](<https://github.com/contexis-cmp/contexis/blob/main/src/cli/commands/deploy_commands.go#L13>)

```go
func GetDeployCommand() *cobra.Command
```

GetDeployCommand returns the deploy command with docker and kubernetes targets

<a name="GetGenerateCommand"></a>
## func [GetGenerateCommand](<https://github.com/contexis-cmp/contexis/blob/main/src/cli/commands/cli_commands.go#L33>)

```go
func GetGenerateCommand() *cobra.Command
```

GetGenerateCommand returns the generate command

<a name="GetHFCommand"></a>
## func [GetHFCommand](<https://github.com/contexis-cmp/contexis/blob/main/src/cli/commands/hf_commands.go#L14>)

```go
func GetHFCommand() *cobra.Command
```



<a name="GetLockCommand"></a>
## func [GetLockCommand](<https://github.com/contexis-cmp/contexis/blob/main/src/cli/commands/lock_commands.go#L24>)

```go
func GetLockCommand() *cobra.Command
```



<a name="GetMemoryCommand"></a>
## func [GetMemoryCommand](<https://github.com/contexis-cmp/contexis/blob/main/src/cli/commands/memory_commands.go#L23>)

```go
func GetMemoryCommand() *cobra.Command
```

GetMemoryCommand returns the \`memory\` command with subcommands for ingest, seed, search, and optimize.

Notable DX helpers:

- \`ctx memory seed \-\-component \<Name\>\`: bulk\-ingests all supported documents under memory/\<Name\>/documents
- \`ctx memory ingest \-\-all \-\-component \<Name\>\`: same as seed, inline flag

<a name="GetMigrateCommand"></a>
## func [GetMigrateCommand](<https://github.com/contexis-cmp/contexis/blob/main/src/cli/commands/migrate.go#L14>)

```go
func GetMigrateCommand() *cobra.Command
```

GetMigrateCommand provides migration utilities for transitioning between environments

<a name="GetModelsCommand"></a>
## func [GetModelsCommand](<https://github.com/contexis-cmp/contexis/blob/main/src/cli/commands/models_cmd.go#L14>)

```go
func GetModelsCommand() *cobra.Command
```

GetModelsCommand provides model utilities like warmup for local models

<a name="GetPluginCommand"></a>
## func [GetPluginCommand](<https://github.com/contexis-cmp/contexis/blob/main/src/cli/commands/plugin_commands.go#L14>)

```go
func GetPluginCommand(projectRoot string) *cobra.Command
```

GetPluginCommand returns the parent plugin command with subcommands.

<a name="GetPromptCommand"></a>
## func [GetPromptCommand](<https://github.com/contexis-cmp/contexis/blob/main/src/cli/commands/prompt_commands.go#L12>)

```go
func GetPromptCommand() *cobra.Command
```



<a name="GetPromptLintCommand"></a>
## func [GetPromptLintCommand](<https://github.com/contexis-cmp/contexis/blob/main/src/cli/commands/prompt_lint.go#L13>)

```go
func GetPromptLintCommand() *cobra.Command
```

Simple prompt linter: detect unused template variables like \{\{.var\}\} not in data

<a name="GetRAGCommand"></a>
## func [GetRAGCommand](<https://github.com/contexis-cmp/contexis/blob/main/src/cli/commands/cli_commands.go#L78>)

```go
func GetRAGCommand() *cobra.Command
```

GetRAGCommand returns the RAG command

<a name="GetRootCommand"></a>
## func [GetRootCommand](<https://github.com/contexis-cmp/contexis/blob/main/src/cli/commands/cli_commands.go#L11>)

```go
func GetRootCommand() *cobra.Command
```

GetRootCommand returns the root command

<a name="GetRunCommand"></a>
## func [GetRunCommand](<https://github.com/contexis-cmp/contexis/blob/main/src/cli/commands/run_commands.go#L46>)

```go
func GetRunCommand() *cobra.Command
```

GetRunCommand returns the \`run\` command.

The \`run\` command executes a one\-off query against a context. If a server is not already running at the provided \`\-\-addr\`, it starts a temporary server in the background using local\-first defaults, sends the request, then shuts the server down. It auto\-detects \`.venv/bin/python\`, sets \`CMP\_LOCAL\_MODELS=true\`, and exports \`CMP\_PROJECT\_ROOT\` to ensure the local provider and templates resolve correctly.

<a name="GetServeCommand"></a>
## func [GetServeCommand](<https://github.com/contexis-cmp/contexis/blob/main/src/cli/commands/serve_commands.go#L20>)

```go
func GetServeCommand() *cobra.Command
```

GetServeCommand returns the \`serve\` command.

The \`serve\` command runs the Contexis HTTP server with sensible local\-first defaults. It auto\-detects a project virtualenv \(\`.venv/bin/python\`\) to use for the local Python provider, sets \`CMP\_LOCAL\_MODELS=true\` when unset, and exports \`CMP\_PROJECT\_ROOT\` to the current working directory for resolving contexts, prompts and memory paths. A warning is printed if \`contexts/\` is not found at the project root.

<a name="GetSetupCommand"></a>
## func [GetSetupCommand](<https://github.com/contexis-cmp/contexis/blob/main/src/cli/commands/setup_command.go#L27>)

```go
func GetSetupCommand() *cobra.Command
```

GetSetupCommand returns the \`setup\` command.

The \`setup\` command bootstraps a local\-first Contexis project by:

1. Creating a Python virtual environment at \`.venv/\` \(if missing\)
2. Upgrading pip and installing required Python dependencies \(transformers, torch, sentence\-transformers\)
3. Optionally warming up a local model so the first inference is fast

Flags:

- \`\-\-model\-id\` \(default: \`sshleifer/tiny\-gpt2\`\) model to warm
- \`\-\-no\-warmup\` to skip the warmup step
- \`\-\-timeout\-seconds\` timeout for warmup execution

<a name="GetVersionCommand"></a>
## func [GetVersionCommand](<https://github.com/contexis-cmp/contexis/blob/main/src/cli/commands/cli_commands.go#L122>)

```go
func GetVersionCommand() *cobra.Command
```

GetVersionCommand returns the version command

<a name="GetWorkerCommand"></a>
## func [GetWorkerCommand](<https://github.com/contexis-cmp/contexis/blob/main/src/cli/commands/worker_commands.go#L8>)

```go
func GetWorkerCommand() *cobra.Command
```



<a name="GetWorkflowCommand"></a>
## func [GetWorkflowCommand](<https://github.com/contexis-cmp/contexis/blob/main/src/cli/commands/cli_commands.go#L95>)

```go
func GetWorkflowCommand() *cobra.Command
```

GetWorkflowCommand returns the workflow command

<a name="RunDriftDetection"></a>
## func [RunDriftDetection](<https://github.com/contexis-cmp/contexis/blob/main/src/cli/commands/drift_runner.go#L79>)

```go
func RunDriftDetection(ctx context.Context, projectRoot string, opts DriftOptions) error
```



<a name="RunGoTests"></a>
## func [RunGoTests](<https://github.com/contexis-cmp/contexis/blob/main/src/cli/commands/go_test_runner.go#L56>)

```go
func RunGoTests(ctx context.Context, projectRoot string, opts TestRunOptions) error
```



<a name="ValidateAgentConfig"></a>
## func [ValidateAgentConfig](<https://github.com/contexis-cmp/contexis/blob/main/src/cli/commands/agent_generator.go#L168>)

```go
func ValidateAgentConfig(tools []string, memory string) error
```

validateAgentConfig validates agent configuration parameters

<a name="ValidateWorkflowConfig"></a>
## func [ValidateWorkflowConfig](<https://github.com/contexis-cmp/contexis/blob/main/src/cli/commands/workflow_generator.go#L173>)

```go
func ValidateWorkflowConfig(steps []string) error
```

ValidateWorkflowConfig validates workflow configuration parameters

<a name="AgentConfig"></a>
## type [AgentConfig](<https://github.com/contexis-cmp/contexis/blob/main/src/cli/commands/agent_generator.go#L18-L38>)

AgentConfig holds configuration for agent generation

```go
type AgentConfig struct {
    Name           string
    Tools          []string
    Memory         string
    Description    string
    Version        string
    Persona        string
    Capabilities   []string
    Limitations    []string
    BusinessRules  []string
    BaselineDate   string
    AdminEmail     string
    Tone           string
    Format         string
    MaxTokens      int
    Temperature    float64
    MemoryType     string
    MaxHistory     int
    Privacy        string
    DriftThreshold float64
}
```

<a name="DriftOptions"></a>
## type [DriftOptions](<https://github.com/contexis-cmp/contexis/blob/main/src/cli/commands/drift_runner.go#L71-L77>)

RunDriftDetection discovers and executes all rag\_drift\_test.yaml specs

```go
type DriftOptions struct {
    OutDir          string
    UpdateBaseline  bool
    UseSemantic     bool
    ComponentFilter string
    WriteJUnit      bool
}
```

<a name="DriftRunReport"></a>
## type [DriftRunReport](<https://github.com/contexis-cmp/contexis/blob/main/src/cli/commands/drift_runner.go#L53-L60>)

Public report structure written as JSON

```go
type DriftRunReport struct {
    Component string            `json:"component"`
    SpecPath  string            `json:"spec_path"`
    Passed    int               `json:"passed"`
    Failed    int               `json:"failed"`
    Total     int               `json:"total"`
    Results   []DriftTestResult `json:"results"`
}
```

<a name="DriftTestResult"></a>
## type [DriftTestResult](<https://github.com/contexis-cmp/contexis/blob/main/src/cli/commands/drift_runner.go#L62-L68>)



```go
type DriftTestResult struct {
    Name       string   `json:"name"`
    Status     string   `json:"status"` // PASSED | FAILED | ERROR
    Similarity float64  `json:"similarity,omitempty"`
    Threshold  float64  `json:"threshold,omitempty"`
    Reasons    []string `json:"reasons,omitempty"`
}
```

<a name="GoSuiteResult"></a>
## type [GoSuiteResult](<https://github.com/contexis-cmp/contexis/blob/main/src/cli/commands/go_test_runner.go#L42-L50>)



```go
type GoSuiteResult struct {
    Suite       string  `json:"suite"`
    Passed      bool    `json:"passed"`
    CoveragePct float64 `json:"coverage_pct,omitempty"`
    Threshold   int     `json:"threshold,omitempty"`
    OutputPath  string  `json:"output_path"`
    ProfilePath string  `json:"profile_path,omitempty"`
    Error       string  `json:"error,omitempty"`
}
```

<a name="GoTestsReport"></a>
## type [GoTestsReport](<https://github.com/contexis-cmp/contexis/blob/main/src/cli/commands/go_test_runner.go#L52-L54>)



```go
type GoTestsReport struct {
    Results []GoSuiteResult `json:"results"`
}
```

<a name="LockFile"></a>
## type [LockFile](<https://github.com/contexis-cmp/contexis/blob/main/src/cli/commands/lock_commands.go#L18-L22>)



```go
type LockFile struct {
    Contexts map[string]string            `json:"contexts"` // name -> sha
    Prompts  map[string]map[string]string `json:"prompts"`  // component -> relPath -> sha
    Memory   map[string]string            `json:"memory"`   // component -> sha of content files
}
```

<a name="ProjectConfig"></a>
## type [ProjectConfig](<https://github.com/contexis-cmp/contexis/blob/main/src/cli/commands/init.go#L33-L39>)



```go
type ProjectConfig struct {
    Name        string
    Description string
    Version     string
    Author      string
    Email       string
}
```

<a name="RAGConfig"></a>
## type [RAGConfig](<https://github.com/contexis-cmp/contexis/blob/main/src/cli/commands/rag_generator.go#L14-L20>)

RAGConfig holds configuration for RAG system generation

```go
type RAGConfig struct {
    Name        string
    DBType      string
    Embeddings  string
    Description string
    Version     string
}
```

<a name="ResourceLimits"></a>
## type [ResourceLimits](<https://github.com/contexis-cmp/contexis/blob/main/src/cli/commands/workflow_generator.go#L53-L58>)

ResourceLimits holds resource constraints for workflows and steps

```go
type ResourceLimits struct {
    CPU     string
    Memory  string
    Storage string
    Network string
}
```

<a name="RunRequest"></a>
## type [RunRequest](<https://github.com/contexis-cmp/contexis/blob/main/src/cli/commands/run_commands.go#L23-L31>)

RunRequest represents the request structure for the run command

```go
type RunRequest struct {
    TenantID   string                 `json:"tenant_id"`
    Context    string                 `json:"context"`
    Component  string                 `json:"component"`
    Query      string                 `json:"query"`
    TopK       int                    `json:"top_k"`
    Data       map[string]interface{} `json:"data"`
    PromptFile string                 `json:"prompt_file"`
}
```

<a name="RunResponse"></a>
## type [RunResponse](<https://github.com/contexis-cmp/contexis/blob/main/src/cli/commands/run_commands.go#L34-L36>)

RunResponse represents the response structure for the run command

```go
type RunResponse struct {
    Rendered string `json:"rendered"`
}
```

<a name="StepConfig"></a>
## type [StepConfig](<https://github.com/contexis-cmp/contexis/blob/main/src/cli/commands/workflow_generator.go#L37-L50>)

StepConfig holds configuration for individual workflow steps

```go
type StepConfig struct {
    Name          string
    Description   string
    Type          string
    Input         map[string]interface{}
    Output        map[string]interface{}
    Dependencies  []string
    Timeout       int
    RetryAttempts int
    Parallel      bool
    Condition     string
    ErrorHandling string
    Resources     ResourceLimits
}
```

<a name="TestRunOptions"></a>
## type [TestRunOptions](<https://github.com/contexis-cmp/contexis/blob/main/src/cli/commands/go_test_runner.go#L17-L26>)



```go
type TestRunOptions struct {
    OutDir     string
    RunUnit    bool
    RunInt     bool
    RunE2E     bool
    UseAll     bool
    Category   string
    Coverage   bool
    WriteJUnit bool
}
```

<a name="Tool"></a>
## type [Tool](<https://github.com/contexis-cmp/contexis/blob/main/src/cli/commands/agent_generator.go#L41-L45>)

Tool represents a tool that can be used by the agent

```go
type Tool struct {
    Name        string
    URI         string
    Description string
}
```

<a name="WorkflowConfig"></a>
## type [WorkflowConfig](<https://github.com/contexis-cmp/contexis/blob/main/src/cli/commands/workflow_generator.go#L16-L34>)

WorkflowConfig holds configuration for workflow generation

```go
type WorkflowConfig struct {
    Name             string
    Steps            []string
    Description      string
    Version          string
    Author           string
    CreatedDate      string
    LastModified     string
    MaxConcurrency   int
    RetryAttempts    int
    RetryDelay       int
    Timeout          int
    StatePersistence bool
    ErrorHandling    string
    Logging          string
    Monitoring       bool
    ResourceLimits   ResourceLimits
    StepsConfig      []StepConfig
}
```

<a name="WorkflowStep"></a>
## type [WorkflowStep](<https://github.com/contexis-cmp/contexis/blob/main/src/cli/commands/workflow_generator.go#L61-L66>)

WorkflowStep represents a step in the workflow

```go
type WorkflowStep struct {
    Name         string
    Type         string
    Description  string
    Dependencies []string
}
```

# config

```go
import "github.com/contexis-cmp/contexis/src/cli/config"
```

Package config provides configuration management for the Contexis CLI.

The config package handles loading, validation, and management of configuration files for CMP contexts, environments, and application settings. It provides structured configuration with security validation and sensitive data handling.

Key Features:

- YAML/JSON configuration loading and validation
- Security validation for project names and file paths
- Sensitive data redaction for logging
- Environment\-specific configuration management
- Schema validation for configuration files

Example Usage:

```
// Load a context configuration
ctxConfig, err := config.LoadContext("path/to/context.yaml")

// Load environment configuration
envConfig, err := config.LoadEnvironment("path/to/environment.yaml")

// Validate project name
err = config.ValidateProjectName("my-project")
```

## Index

- [func RedactSensitiveData\(data string\) string](<#RedactSensitiveData>)
- [func SafeJoin\(base, path string\) \(string, error\)](<#SafeJoin>)
- [func ValidateProjectName\(name string\) error](<#ValidateProjectName>)
- [type ContextConfig](<#ContextConfig>)
  - [func LoadContext\(path string\) \(\*ContextConfig, error\)](<#LoadContext>)
- [type DatabaseConfig](<#DatabaseConfig>)
- [type EmbeddingConfig](<#EmbeddingConfig>)
- [type EnvironmentConfig](<#EnvironmentConfig>)
  - [func LoadEnvironment\(path string\) \(\*EnvironmentConfig, error\)](<#LoadEnvironment>)
- [type FeatureConfig](<#FeatureConfig>)
- [type GuardrailConfig](<#GuardrailConfig>)
- [type LoggingConfig](<#LoggingConfig>)
- [type MemoryConfig](<#MemoryConfig>)
- [type ProviderConfig](<#ProviderConfig>)
- [type RoleConfig](<#RoleConfig>)
- [type TestingConfig](<#TestingConfig>)
- [type ToolConfig](<#ToolConfig>)
- [type VectorDBConfig](<#VectorDBConfig>)


<a name="RedactSensitiveData"></a>
## func [RedactSensitiveData](<https://github.com/contexis-cmp/contexis/blob/main/src/cli/config/config.go#L380>)

```go
func RedactSensitiveData(data string) string
```

RedactSensitiveData removes sensitive information from logs. It identifies and replaces sensitive data like API keys, passwords, and tokens with placeholder values to prevent accidental exposure.

Parameters:

- data: String containing potentially sensitive data

Returns:

- string: String with sensitive data redacted

<a name="SafeJoin"></a>
## func [SafeJoin](<https://github.com/contexis-cmp/contexis/blob/main/src/cli/config/config.go#L363>)

```go
func SafeJoin(base, path string) (string, error)
```

SafeJoin safely joins paths to prevent directory traversal attacks. It ensures that the resulting path doesn't escape the base directory and provides protection against path traversal vulnerabilities.

Parameters:

- base: Base directory path
- path: Path to join with the base

Returns:

- string: Safely joined path
- error: Error if the path would escape the base directory

<a name="ValidateProjectName"></a>
## func [ValidateProjectName](<https://github.com/contexis-cmp/contexis/blob/main/src/cli/config/config.go#L331>)

```go
func ValidateProjectName(name string) error
```

ValidateProjectName validates project name according to security rules. It ensures project names are safe and don't contain dangerous characters or patterns that could lead to security vulnerabilities.

Parameters:

- name: Project name to validate

Returns:

- error: Validation error if the name is invalid, nil otherwise

<a name="ContextConfig"></a>
## type [ContextConfig](<https://github.com/contexis-cmp/contexis/blob/main/src/cli/config/config.go#L40-L73>)

ContextConfig represents a CMP context configuration. It defines the structure and behavior of an AI agent or component within the CMP framework, including its role, tools, and constraints.

```go
type ContextConfig struct {
    // Name is the unique identifier for the context
    Name string `json:"name" yaml:"name"`

    // Version follows semantic versioning (e.g., "1.0.0")
    Version string `json:"version" yaml:"version"`

    // Description provides human-readable information about the context
    Description string `json:"description,omitempty" yaml:"description,omitempty"`

    // Role defines the agent's persona, capabilities, and limitations
    Role RoleConfig `json:"role" yaml:"role"`

    // Tools defines the available tools and their configurations
    Tools []ToolConfig `json:"tools,omitempty" yaml:"tools,omitempty"`

    // Guardrails defines safety constraints and behavior limits
    Guardrails GuardrailConfig `json:"guardrails,omitempty" yaml:"guardrails,omitempty"`

    // Memory defines memory settings and configuration
    Memory MemoryConfig `json:"memory,omitempty" yaml:"memory,omitempty"`

    // Testing defines testing parameters and validation rules
    Testing TestingConfig `json:"testing,omitempty" yaml:"testing,omitempty"`

    // CreatedAt is the timestamp when the context was created
    CreatedAt time.Time `json:"created_at" yaml:"created_at"`

    // UpdatedAt is the timestamp when the context was last modified
    UpdatedAt time.Time `json:"updated_at" yaml:"updated_at"`

    // Metadata contains additional key-value pairs for extensibility
    Metadata map[string]string `json:"metadata,omitempty" yaml:"metadata,omitempty"`
}
```

<a name="LoadContext"></a>
### func [LoadContext](<https://github.com/contexis-cmp/contexis/blob/main/src/cli/config/config.go#L271>)

```go
func LoadContext(path string) (*ContextConfig, error)
```

LoadContext loads and validates a context configuration file. It reads a YAML file and unmarshals it into a ContextConfig structure, performing validation to ensure the configuration is valid.

Parameters:

- path: File path to the context configuration file

Returns:

- \*ContextConfig: Loaded and validated context configuration
- error: Any error that occurred during loading or validation

<a name="DatabaseConfig"></a>
## type [DatabaseConfig](<https://github.com/contexis-cmp/contexis/blob/main/src/cli/config/config.go#L174-L186>)

DatabaseConfig defines database settings. It specifies connection parameters and configuration for various database types used by the application.

```go
type DatabaseConfig struct {
    // Type specifies the database type (e.g., "sqlite", "postgres")
    Type string `json:"type" yaml:"type"`

    // URL is the database connection string
    URL string `json:"url" yaml:"url"`

    // Options contains additional database-specific options
    Options map[string]string `json:"options,omitempty" yaml:"options,omitempty"`

    // MaxConnections limits the number of database connections
    MaxConnections int `json:"max_connections,omitempty" yaml:"max_connections,omitempty"`
}
```

<a name="EmbeddingConfig"></a>
## type [EmbeddingConfig](<https://github.com/contexis-cmp/contexis/blob/main/src/cli/config/config.go#L205-L214>)

EmbeddingConfig defines embedding model settings. It specifies configuration for text embedding models used for semantic search and vector operations.

```go
type EmbeddingConfig struct {
    // Provider specifies the embedding provider
    Provider string `json:"provider" yaml:"provider"`

    // Model specifies the embedding model to use
    Model string `json:"model" yaml:"model"`

    // Dimensions specifies the embedding vector dimensions
    Dimensions int `json:"dimensions" yaml:"dimensions"`
}
```

<a name="EnvironmentConfig"></a>
## type [EnvironmentConfig](<https://github.com/contexis-cmp/contexis/blob/main/src/cli/config/config.go#L148-L169>)

EnvironmentConfig represents environment\-specific settings. It defines configuration that varies between development, staging, and production environments.

```go
type EnvironmentConfig struct {
    // Environment specifies the environment name
    Environment string `json:"environment" yaml:"environment"`

    // Database defines database connection settings
    Database DatabaseConfig `json:"database" yaml:"database"`

    // Providers defines AI model provider configurations
    Providers map[string]ProviderConfig `json:"providers" yaml:"providers"`

    // Embeddings defines embedding model configurations
    Embeddings EmbeddingConfig `json:"embeddings" yaml:"embeddings"`

    // VectorDB defines vector database configurations
    VectorDB VectorDBConfig `json:"vector_db" yaml:"vector_db"`

    // Logging defines logging configuration
    Logging LoggingConfig `json:"logging" yaml:"logging"`

    // Features defines feature flags and toggles
    Features FeatureConfig `json:"features" yaml:"features"`
}
```

<a name="LoadEnvironment"></a>
### func [LoadEnvironment](<https://github.com/contexis-cmp/contexis/blob/main/src/cli/config/config.go#L303>)

```go
func LoadEnvironment(path string) (*EnvironmentConfig, error)
```

LoadEnvironment loads and validates an environment configuration file. It reads a YAML file and unmarshals it into an EnvironmentConfig structure, performing validation to ensure the configuration is valid.

Parameters:

- path: File path to the environment configuration file

Returns:

- \*EnvironmentConfig: Loaded and validated environment configuration
- error: Any error that occurred during loading or validation

<a name="FeatureConfig"></a>
## type [FeatureConfig](<https://github.com/contexis-cmp/contexis/blob/main/src/cli/config/config.go#L250-L259>)

FeatureConfig defines feature flags and toggles. It provides a way to enable or disable features without code changes.

```go
type FeatureConfig struct {
    // Enabled features list
    Enabled []string `json:"enabled" yaml:"enabled"`

    // Disabled features list
    Disabled []string `json:"disabled" yaml:"disabled"`

    // Options contains feature-specific configuration
    Options map[string]interface{} `json:"options,omitempty" yaml:"options,omitempty"`
}
```

<a name="GuardrailConfig"></a>
## type [GuardrailConfig](<https://github.com/contexis-cmp/contexis/blob/main/src/cli/config/config.go#L106-L118>)

GuardrailConfig defines safety constraints for the agent. It provides mechanisms to ensure the agent operates within defined boundaries and safety parameters.

```go
type GuardrailConfig struct {
    // Tone specifies the desired communication style
    Tone string `json:"tone,omitempty" yaml:"tone,omitempty"`

    // Format specifies the output format requirements
    Format string `json:"format,omitempty" yaml:"format,omitempty"`

    // MaxTokens limits the maximum response length
    MaxTokens int `json:"max_tokens,omitempty" yaml:"max_tokens,omitempty"`

    // Temperature controls response randomness (0.0 to 1.0)
    Temperature float64 `json:"temperature,omitempty" yaml:"temperature,omitempty"`
}
```

<a name="LoggingConfig"></a>
## type [LoggingConfig](<https://github.com/contexis-cmp/contexis/blob/main/src/cli/config/config.go#L236-L245>)

LoggingConfig defines logging settings. It specifies how the application should log events, errors, and debugging information.

```go
type LoggingConfig struct {
    // Level specifies the logging level (debug, info, warn, error)
    Level string `json:"level" yaml:"level"`

    // Format specifies the log format (json, text)
    Format string `json:"format" yaml:"format"`

    // Output specifies the log output destination
    Output string `json:"output" yaml:"output"`
}
```

<a name="MemoryConfig"></a>
## type [MemoryConfig](<https://github.com/contexis-cmp/contexis/blob/main/src/cli/config/config.go#L123-L132>)

MemoryConfig defines memory settings for the agent. It controls how the agent stores and retrieves information across conversations and interactions.

```go
type MemoryConfig struct {
    // Episodic enables episodic memory for conversation history
    Episodic bool `json:"episodic" yaml:"episodic"`

    // MaxHistory limits the number of conversation turns to remember
    MaxHistory int `json:"max_history" yaml:"max_history"`

    // Privacy specifies the privacy level: "user_isolated", "shared", "public"
    Privacy string `json:"privacy" yaml:"privacy"`
}
```

<a name="ProviderConfig"></a>
## type [ProviderConfig](<https://github.com/contexis-cmp/contexis/blob/main/src/cli/config/config.go#L191-L200>)

ProviderConfig defines AI model provider settings. It specifies configuration for external AI model providers like OpenAI, Anthropic, or Hugging Face.

```go
type ProviderConfig struct {
    // APIKey is the provider's API key (sensitive)
    APIKey string `json:"api_key" yaml:"api_key"`

    // Model specifies the model to use
    Model string `json:"model" yaml:"model"`

    // BaseURL is the provider's API base URL
    BaseURL string `json:"base_url,omitempty" yaml:"base_url,omitempty"`
}
```

<a name="RoleConfig"></a>
## type [RoleConfig](<https://github.com/contexis-cmp/contexis/blob/main/src/cli/config/config.go#L78-L87>)

RoleConfig defines the agent's role and capabilities. It specifies the persona, capabilities, and limitations that guide the agent's behavior and responses.

```go
type RoleConfig struct {
    // Persona defines the agent's character and personality
    Persona string `json:"persona" yaml:"persona"`

    // Capabilities lists the agent's abilities and functions
    Capabilities []string `json:"capabilities" yaml:"capabilities"`

    // Limitations lists the agent's restrictions and boundaries
    Limitations []string `json:"limitations" yaml:"limitations"`
}
```

<a name="TestingConfig"></a>
## type [TestingConfig](<https://github.com/contexis-cmp/contexis/blob/main/src/cli/config/config.go#L137-L143>)

TestingConfig defines testing parameters for the context. It specifies how the context should be tested and validated to ensure proper functionality and behavior.

```go
type TestingConfig struct {
    // DriftThreshold defines the similarity threshold for drift detection
    DriftThreshold float64 `json:"drift_threshold" yaml:"drift_threshold"`

    // BusinessRules lists business logic rules for validation
    BusinessRules []string `json:"business_rules" yaml:"business_rules"`
}
```

<a name="ToolConfig"></a>
## type [ToolConfig](<https://github.com/contexis-cmp/contexis/blob/main/src/cli/config/config.go#L92-L101>)

ToolConfig defines an MCP \(Model Context Protocol\) tool. It specifies the configuration for external tools that the agent can use to extend its capabilities.

```go
type ToolConfig struct {
    // Name is the unique identifier for the tool
    Name string `json:"name" yaml:"name"`

    // URI is the MCP URI for the tool
    URI string `json:"uri" yaml:"uri"`

    // Description provides human-readable information about the tool
    Description string `json:"description,omitempty" yaml:"description,omitempty"`
}
```

<a name="VectorDBConfig"></a>
## type [VectorDBConfig](<https://github.com/contexis-cmp/contexis/blob/main/src/cli/config/config.go#L219-L231>)

VectorDBConfig defines vector database settings. It specifies configuration for vector databases used to store and search embeddings.

```go
type VectorDBConfig struct {
    // Provider specifies the vector database provider
    Provider string `json:"provider" yaml:"provider"`

    // URL is the vector database connection string
    URL string `json:"url" yaml:"url"`

    // IndexName specifies the index to use
    IndexName string `json:"index_name" yaml:"index_name"`

    // Options contains additional provider-specific options
    Options map[string]string `json:"options,omitempty" yaml:"options,omitempty"`
}
```

# logger

```go
import "github.com/contexis-cmp/contexis/src/cli/logger"
```

Package logger provides structured logging functionality for the Contexis CLI.

The logger package implements Rails\-inspired colored console output with structured logging capabilities. It provides both colored and JSON logging formats with configurable levels and output destinations.

Key Features:

- Rails\-like colored console output
- Structured JSON logging for production
- Configurable log levels and formats
- Colored log levels and timestamps
- Helper functions for common log operations

Example Usage:

```
// Initialize colored logger
err := logger.InitColoredLogger("info")

// Get logger instance
log := logger.GetLogger()

// Log with different levels
log.Info("Application started")
log.Error("An error occurred", zap.Error(err))

// Use helper functions
logger.LogSuccess("Operation completed successfully")
logger.LogWarning("Deprecated feature used")
```

## Index

- [Constants](<#constants>)
- [func GetLogger\(\) \*zap.Logger](<#GetLogger>)
- [func InitColoredLogger\(level string\) error](<#InitColoredLogger>)
- [func InitLogger\(level string, format string\) error](<#InitLogger>)
- [func LogDebug\(message string\)](<#LogDebug>)
- [func LogDebugWithContext\(ctx context.Context, message string, fields ...zap.Field\)](<#LogDebugWithContext>)
- [func LogError\(ctx context.Context, msg string, err error, fields ...zap.Field\)](<#LogError>)
- [func LogErrorColored\(ctx context.Context, message string, err error, fields ...zap.Field\)](<#LogErrorColored>)
- [func LogInfo\(ctx context.Context, message string, fields ...zap.Field\)](<#LogInfo>)
- [func LogOperation\(ctx context.Context, operation string, fields ...zap.Field\) func\(\)](<#LogOperation>)
- [func LogOperationColored\(ctx context.Context, operation string, fields ...zap.Field\) func\(\)](<#LogOperationColored>)
- [func LogSecurity\(ctx context.Context, event string, fields ...zap.Field\)](<#LogSecurity>)
- [func LogSecurityColored\(event, details string\)](<#LogSecurityColored>)
- [func LogSuccess\(ctx context.Context, message string, fields ...zap.Field\)](<#LogSuccess>)
- [func LogWarning\(message string\)](<#LogWarning>)
- [func NewColoredEncoder\(\) zapcore.Encoder](<#NewColoredEncoder>)
- [func WithContext\(ctx context.Context\) \*zap.Logger](<#WithContext>)
- [func WithFields\(fields ...zap.Field\) \*zap.Logger](<#WithFields>)
- [type ColoredEncoder](<#ColoredEncoder>)


## Constants

<a name="ColorReset"></a>Color constants for terminal output

```go
const (
    // ANSI color codes
    ColorReset  = "\033[0m"
    ColorRed    = "\033[31m"
    ColorGreen  = "\033[32m"
    ColorYellow = "\033[33m"
    ColorBlue   = "\033[34m"
    ColorPurple = "\033[35m"
    ColorCyan   = "\033[36m"
    ColorWhite  = "\033[37m"
    ColorGray   = "\033[90m"

    // Bright colors
    ColorBrightRed    = "\033[91m"
    ColorBrightGreen  = "\033[92m"
    ColorBrightYellow = "\033[93m"
    ColorBrightBlue   = "\033[94m"
    ColorBrightPurple = "\033[95m"
    ColorBrightCyan   = "\033[96m"
    ColorBrightWhite  = "\033[97m"

    // Background colors
    ColorBgRed    = "\033[41m"
    ColorBgGreen  = "\033[42m"
    ColorBgYellow = "\033[43m"
    ColorBgBlue   = "\033[44m"
    ColorBgPurple = "\033[45m"
    ColorBgCyan   = "\033[46m"
    ColorBgWhite  = "\033[47m"
)
```

<a name="GetLogger"></a>
## func [GetLogger](<https://github.com/contexis-cmp/contexis/blob/main/src/cli/logger/logger.go#L55>)

```go
func GetLogger() *zap.Logger
```

GetLogger returns the global logger

<a name="InitColoredLogger"></a>
## func [InitColoredLogger](<https://github.com/contexis-cmp/contexis/blob/main/src/cli/logger/colored_logger.go#L135>)

```go
func InitColoredLogger(level string) error
```

InitColoredLogger initializes a colored logger similar to Rails. It sets up a logger with colored console output and configurable log level. The logger will use colors when outputting to a terminal and fall back to plain text when redirected to a file.

Parameters:

- level: Log level string \(debug, info, warn, error\)

Returns:

- error: Any error that occurred during initialization

<a name="InitLogger"></a>
## func [InitLogger](<https://github.com/contexis-cmp/contexis/blob/main/src/cli/logger/logger.go#L15>)

```go
func InitLogger(level string, format string) error
```

InitLogger initializes the global logger

<a name="LogDebug"></a>
## func [LogDebug](<https://github.com/contexis-cmp/contexis/blob/main/src/cli/logger/colored_logger.go#L283>)

```go
func LogDebug(message string)
```

LogDebug logs a debug message with gray color. It provides a convenient way to log debug messages with consistent formatting.

Parameters:

- message: Debug message

<a name="LogDebugWithContext"></a>
## func [LogDebugWithContext](<https://github.com/contexis-cmp/contexis/blob/main/src/cli/logger/colored_logger.go#L289>)

```go
func LogDebugWithContext(ctx context.Context, message string, fields ...zap.Field)
```

LogDebugWithContext logs a debug message with context support.

<a name="LogError"></a>
## func [LogError](<https://github.com/contexis-cmp/contexis/blob/main/src/cli/logger/logger.go#L123>)

```go
func LogError(ctx context.Context, msg string, err error, fields ...zap.Field)
```

LogError logs an error with context

<a name="LogErrorColored"></a>
## func [LogErrorColored](<https://github.com/contexis-cmp/contexis/blob/main/src/cli/logger/colored_logger.go#L222>)

```go
func LogErrorColored(ctx context.Context, message string, err error, fields ...zap.Field)
```

LogErrorColored logs an error with colored output. It provides a convenient way to log errors with consistent formatting and color coding.

Parameters:

- ctx: Context for request tracking
- message: Error message
- err: The error object
- fields: Additional structured fields

<a name="LogInfo"></a>
## func [LogInfo](<https://github.com/contexis-cmp/contexis/blob/main/src/cli/logger/colored_logger.go#L272>)

```go
func LogInfo(ctx context.Context, message string, fields ...zap.Field)
```

LogInfo logs an info message with blue color. It provides a convenient way to log informational messages with consistent formatting.

Parameters:

- ctx: Context for request tracking
- message: Info message
- fields: Additional structured fields

<a name="LogOperation"></a>
## func [LogOperation](<https://github.com/contexis-cmp/contexis/blob/main/src/cli/logger/logger.go#L108>)

```go
func LogOperation(ctx context.Context, operation string, fields ...zap.Field) func()
```

LogOperation logs the start and completion of an operation

<a name="LogOperationColored"></a>
## func [LogOperationColored](<https://github.com/contexis-cmp/contexis/blob/main/src/cli/logger/colored_logger.go#L202>)

```go
func LogOperationColored(ctx context.Context, operation string, fields ...zap.Field) func()
```

LogOperationColored logs an operation with colored output. It provides a convenient way to log operations with consistent formatting and color coding.

Parameters:

- ctx: Context for request tracking
- operation: The operation being performed
- fields: Additional structured fields

<a name="LogSecurity"></a>
## func [LogSecurity](<https://github.com/contexis-cmp/contexis/blob/main/src/cli/logger/logger.go#L129>)

```go
func LogSecurity(ctx context.Context, event string, fields ...zap.Field)
```

LogSecurity logs security\-related events

<a name="LogSecurityColored"></a>
## func [LogSecurityColored](<https://github.com/contexis-cmp/contexis/blob/main/src/cli/logger/colored_logger.go#L235>)

```go
func LogSecurityColored(event, details string)
```

LogSecurityColored logs security\-related events with colored output. It provides a convenient way to log security events with consistent formatting and color coding.

Parameters:

- event: The security event
- details: Additional details about the event

<a name="LogSuccess"></a>
## func [LogSuccess](<https://github.com/contexis-cmp/contexis/blob/main/src/cli/logger/colored_logger.go#L248>)

```go
func LogSuccess(ctx context.Context, message string, fields ...zap.Field)
```

LogSuccess logs a success message with green color. It provides a convenient way to log successful operations with consistent formatting.

Parameters:

- ctx: Context for request tracking
- message: Success message
- fields: Additional structured fields

<a name="LogWarning"></a>
## func [LogWarning](<https://github.com/contexis-cmp/contexis/blob/main/src/cli/logger/colored_logger.go#L259>)

```go
func LogWarning(message string)
```

LogWarning logs a warning message with yellow color. It provides a convenient way to log warnings with consistent formatting.

Parameters:

- message: Warning message

<a name="NewColoredEncoder"></a>
## func [NewColoredEncoder](<https://github.com/contexis-cmp/contexis/blob/main/src/cli/logger/colored_logger.go#L86>)

```go
func NewColoredEncoder() zapcore.Encoder
```

NewColoredEncoder creates a new colored encoder. It wraps a console encoder with color formatting for log levels and other log components.

Returns:

- zapcore.Encoder: A colored encoder instance

<a name="WithContext"></a>
## func [WithContext](<https://github.com/contexis-cmp/contexis/blob/main/src/cli/logger/logger.go#L64>)

```go
func WithContext(ctx context.Context) *zap.Logger
```

WithContext returns a logger with context fields

<a name="WithFields"></a>
## func [WithFields](<https://github.com/contexis-cmp/contexis/blob/main/src/cli/logger/logger.go#L81>)

```go
func WithFields(fields ...zap.Field) *zap.Logger
```

WithFields returns a logger with additional fields

<a name="ColoredEncoder"></a>
## type [ColoredEncoder](<https://github.com/contexis-cmp/contexis/blob/main/src/cli/logger/colored_logger.go#L76-L78>)

ColoredEncoder provides Rails\-like colored console output. It implements zapcore.Encoder to provide colored log output similar to Rails' console logging with colored levels and timestamps.

```go
type ColoredEncoder struct {
    zapcore.Encoder
}
```

# context

```go
import "github.com/contexis-cmp/contexis/src/core/context"
```

Package context defines the Contexis CMP Context domain model.

A Context is a declarative specification of an AI agent: role/persona, capabilities, tool integrations, guardrails, memory behavior, and testing configuration. Contexts are authored as YAML \(\`.ctx\`\) files and validated against a JSON Schema at load time. The types in this package map 1:1 to the persisted representation and are used across the runtime and tooling.

## Index

- [type Context](<#Context>)
  - [func FromJSON\(data \[\]byte\) \(\*Context, error\)](<#FromJSON>)
  - [func New\(name, version string\) \*Context](<#New>)
  - [func \(c \*Context\) GetSHA\(\) \(string, error\)](<#Context.GetSHA>)
  - [func \(c \*Context\) ToJSON\(\) \(\[\]byte, error\)](<#Context.ToJSON>)
  - [func \(c \*Context\) Validate\(\) error](<#Context.Validate>)
- [type Guardrails](<#Guardrails>)
- [type MemoryConfig](<#MemoryConfig>)
- [type Role](<#Role>)
- [type TestingConfig](<#TestingConfig>)
- [type Tool](<#Tool>)


<a name="Context"></a>
## type [Context](<https://github.com/contexis-cmp/contexis/blob/main/src/core/context/context.go#L16-L30>)

Context represents a declarative agent specification in the CMP framework.

A Context defines the agent's name and version, role/persona with capabilities, available tools, guardrails, memory behavior, and testing configuration. Contexts are typically loaded from \`.ctx\` YAML files.

```go
type Context struct {
    Name        string `json:"name" yaml:"name"`
    Version     string `json:"version" yaml:"version"`
    Description string `json:"description,omitempty" yaml:"description,omitempty"`

    Role       Role          `json:"role" yaml:"role"`
    Tools      []Tool        `json:"tools,omitempty" yaml:"tools,omitempty"`
    Guardrails Guardrails    `json:"guardrails,omitempty" yaml:"guardrails,omitempty"`
    Memory     MemoryConfig  `json:"memory,omitempty" yaml:"memory,omitempty"`
    Testing    TestingConfig `json:"testing,omitempty" yaml:"testing,omitempty"`

    CreatedAt time.Time         `json:"created_at" yaml:"created_at"`
    UpdatedAt time.Time         `json:"updated_at" yaml:"updated_at"`
    Metadata  map[string]string `json:"metadata,omitempty" yaml:"metadata,omitempty"`
}
```

<a name="FromJSON"></a>
### func [FromJSON](<https://github.com/contexis-cmp/contexis/blob/main/src/core/context/context.go#L102>)

```go
func FromJSON(data []byte) (*Context, error)
```

FromJSON parses a Context value from JSON bytes.

<a name="New"></a>
### func [New](<https://github.com/contexis-cmp/contexis/blob/main/src/core/context/context.go#L69>)

```go
func New(name, version string) *Context
```

New creates a new Context with default values.

<details><summary>Example</summary>
<p>



```go
c := New("SupportBot", "1.0.0")
fmt.Println(c.Name, c.Version)
// Output:
// SupportBot 1.0.0
```

#### Output

```
SupportBot 1.0.0
```

</p>
</details>

<a name="Context.GetSHA"></a>
### func \(\*Context\) [GetSHA](<https://github.com/contexis-cmp/contexis/blob/main/src/core/context/context.go#L112>)

```go
func (c *Context) GetSHA() (string, error)
```

GetSHA returns a content\-addressed SHA\-256 hash of the Context, suitable for immutable versioning and provenance.

<details><summary>Example</summary>
<p>



```go
c := New("MyAgent", "0.1.14")
sha, _ := c.GetSHA()
fmt.Println(strings.HasPrefix(sha, "sha256:"))
// Output:
// true
```

#### Output

```
true
```

</p>
</details>

<a name="Context.ToJSON"></a>
### func \(\*Context\) [ToJSON](<https://github.com/contexis-cmp/contexis/blob/main/src/core/context/context.go#L97>)

```go
func (c *Context) ToJSON() ([]byte, error)
```

ToJSON converts the Context to pretty\-printed JSON bytes.

<a name="Context.Validate"></a>
### func \(\*Context\) [Validate](<https://github.com/contexis-cmp/contexis/blob/main/src/core/context/context.go#L83>)

```go
func (c *Context) Validate() error
```

Validate ensures the Context has the required fields populated.

<details><summary>Example</summary>
<p>



```go
c := New("MyAgent", "0.1.14")
c.Role.Persona = "Helpful assistant"
fmt.Println(c.Validate() == nil)
// Output:
// true
```

#### Output

```
true
```

</p>
</details>

<a name="Guardrails"></a>
## type [Guardrails](<https://github.com/contexis-cmp/contexis/blob/main/src/core/context/context.go#L47-L52>)

Guardrails define behavioral constraints for agent responses.

```go
type Guardrails struct {
    Tone        string  `json:"tone,omitempty" yaml:"tone,omitempty"`
    Format      string  `json:"format,omitempty" yaml:"format,omitempty"`
    MaxTokens   int     `json:"max_tokens,omitempty" yaml:"max_tokens,omitempty"`
    Temperature float64 `json:"temperature,omitempty" yaml:"temperature,omitempty"`
}
```

<a name="MemoryConfig"></a>
## type [MemoryConfig](<https://github.com/contexis-cmp/contexis/blob/main/src/core/context/context.go#L55-L59>)

MemoryConfig defines conversational memory behavior for an agent.

```go
type MemoryConfig struct {
    Episodic   bool   `json:"episodic" yaml:"episodic"`
    MaxHistory int    `json:"max_history" yaml:"max_history"`
    Privacy    string `json:"privacy" yaml:"privacy"`
}
```

<a name="Role"></a>
## type [Role](<https://github.com/contexis-cmp/contexis/blob/main/src/core/context/context.go#L33-L37>)

Role defines the agent persona and allowed capabilities.

```go
type Role struct {
    Persona      string   `json:"persona" yaml:"persona"`
    Capabilities []string `json:"capabilities" yaml:"capabilities"`
    Limitations  []string `json:"limitations" yaml:"limitations"`
}
```

<a name="TestingConfig"></a>
## type [TestingConfig](<https://github.com/contexis-cmp/contexis/blob/main/src/core/context/context.go#L63-L66>)

TestingConfig defines testing parameters such as drift thresholds and business rules that should hold in automated tests.

```go
type TestingConfig struct {
    DriftThreshold float64  `json:"drift_threshold" yaml:"drift_threshold"`
    BusinessRules  []string `json:"business_rules" yaml:"business_rules"`
}
```

<a name="Tool"></a>
## type [Tool](<https://github.com/contexis-cmp/contexis/blob/main/src/core/context/context.go#L40-L44>)

Tool represents an external function or integration available to the agent.

```go
type Tool struct {
    Name        string `json:"name" yaml:"name"`
    URI         string `json:"uri" yaml:"uri"`
    Description string `json:"description,omitempty" yaml:"description,omitempty"`
}
```

# memory

```go
import "github.com/contexis-cmp/contexis/src/core/memory"
```

## Index

- [type Memory](<#Memory>)
  - [func FromJSON\(data \[\]byte\) \(\*Memory, error\)](<#FromJSON>)
  - [func New\(name, version, memoryType string\) \*Memory](<#New>)
  - [func \(m \*Memory\) AddItem\(content, itemType string, metadata map\[string\]interface\{\}\)](<#Memory.AddItem>)
  - [func \(m \*Memory\) GetSHA\(\) \(string, error\)](<#Memory.GetSHA>)
  - [func \(m \*Memory\) Search\(query string, limit int\) \(\[\]MemoryItem, error\)](<#Memory.Search>)
  - [func \(m \*Memory\) ToJSON\(\) \(\[\]byte, error\)](<#Memory.ToJSON>)
  - [func \(m \*Memory\) Validate\(\) error](<#Memory.Validate>)
- [type MemoryConfig](<#MemoryConfig>)
- [type MemoryItem](<#MemoryItem>)
- [type MemorySchema](<#MemorySchema>)
- [type SchemaField](<#SchemaField>)


<a name="Memory"></a>
## type [Memory](<https://github.com/contexis-cmp/contexis/blob/main/src/core/memory/memory.go#L10-L23>)

Memory represents versioned knowledge stores in the CMP framework

```go
type Memory struct {
    Name        string `json:"name" yaml:"name"`
    Version     string `json:"version" yaml:"version"`
    Type        string `json:"type" yaml:"type"` // "vector", "episodic", "semantic"
    Description string `json:"description,omitempty" yaml:"description,omitempty"`

    Content []MemoryItem `json:"content" yaml:"content"`
    Schema  MemorySchema `json:"schema,omitempty" yaml:"schema,omitempty"`
    Config  MemoryConfig `json:"config" yaml:"config"`

    CreatedAt time.Time         `json:"created_at" yaml:"created_at"`
    UpdatedAt time.Time         `json:"updated_at" yaml:"updated_at"`
    Metadata  map[string]string `json:"metadata,omitempty" yaml:"metadata,omitempty"`
}
```

<a name="FromJSON"></a>
### func [FromJSON](<https://github.com/contexis-cmp/contexis/blob/main/src/core/memory/memory.go#L127>)

```go
func FromJSON(data []byte) (*Memory, error)
```

FromJSON creates a memory from JSON

<a name="New"></a>
### func [New](<https://github.com/contexis-cmp/contexis/blob/main/src/core/memory/memory.go#L62>)

```go
func New(name, version, memoryType string) *Memory
```

New creates a new Memory with default values

<a name="Memory.AddItem"></a>
### func \(\*Memory\) [AddItem](<https://github.com/contexis-cmp/contexis/blob/main/src/core/memory/memory.go#L80>)

```go
func (m *Memory) AddItem(content, itemType string, metadata map[string]interface{})
```

AddItem adds a new memory item

<a name="Memory.GetSHA"></a>
### func \(\*Memory\) [GetSHA](<https://github.com/contexis-cmp/contexis/blob/main/src/core/memory/memory.go#L136>)

```go
func (m *Memory) GetSHA() (string, error)
```

GetSHA returns a content\-based hash for versioning

<a name="Memory.Search"></a>
### func \(\*Memory\) [Search](<https://github.com/contexis-cmp/contexis/blob/main/src/core/memory/memory.go#L94>)

```go
func (m *Memory) Search(query string, limit int) ([]MemoryItem, error)
```

Search performs semantic search on memory content

<a name="Memory.ToJSON"></a>
### func \(\*Memory\) [ToJSON](<https://github.com/contexis-cmp/contexis/blob/main/src/core/memory/memory.go#L122>)

```go
func (m *Memory) ToJSON() ([]byte, error)
```

ToJSON converts the memory to JSON

<a name="Memory.Validate"></a>
### func \(\*Memory\) [Validate](<https://github.com/contexis-cmp/contexis/blob/main/src/core/memory/memory.go#L108>)

```go
func (m *Memory) Validate() error
```

Validate ensures the memory is properly configured

<a name="MemoryConfig"></a>
## type [MemoryConfig](<https://github.com/contexis-cmp/contexis/blob/main/src/core/memory/memory.go#L52-L59>)

MemoryConfig defines memory behavior and storage

```go
type MemoryConfig struct {
    Provider   string            `json:"provider" yaml:"provider"`     // "sqlite", "postgres", "chroma", "pinecone"
    Embeddings string            `json:"embeddings" yaml:"embeddings"` // "openai", "sentence-transformers"
    ChunkSize  int               `json:"chunk_size" yaml:"chunk_size"`
    Overlap    int               `json:"overlap" yaml:"overlap"`
    MaxTokens  int               `json:"max_tokens" yaml:"max_tokens"`
    Settings   map[string]string `json:"settings,omitempty" yaml:"settings,omitempty"`
}
```

<a name="MemoryItem"></a>
## type [MemoryItem](<https://github.com/contexis-cmp/contexis/blob/main/src/core/memory/memory.go#L26-L34>)

MemoryItem represents a single piece of knowledge

```go
type MemoryItem struct {
    ID        string                 `json:"id" yaml:"id"`
    Content   string                 `json:"content" yaml:"content"`
    Type      string                 `json:"type" yaml:"type"` // "text", "document", "conversation"
    Embedding []float64              `json:"embedding,omitempty" yaml:"embedding,omitempty"`
    Metadata  map[string]interface{} `json:"metadata,omitempty" yaml:"metadata,omitempty"`
    CreatedAt time.Time              `json:"created_at" yaml:"created_at"`
    UpdatedAt time.Time              `json:"updated_at" yaml:"updated_at"`
}
```

<a name="MemorySchema"></a>
## type [MemorySchema](<https://github.com/contexis-cmp/contexis/blob/main/src/core/memory/memory.go#L37-L41>)

MemorySchema defines the structure of memory items

```go
type MemorySchema struct {
    Fields   []SchemaField `json:"fields" yaml:"fields"`
    Required []string      `json:"required,omitempty" yaml:"required,omitempty"`
    Indexes  []string      `json:"indexes,omitempty" yaml:"indexes,omitempty"`
}
```

<a name="SchemaField"></a>
## type [SchemaField](<https://github.com/contexis-cmp/contexis/blob/main/src/core/memory/memory.go#L44-L49>)

SchemaField defines a field in the memory schema

```go
type SchemaField struct {
    Name        string `json:"name" yaml:"name"`
    Type        string `json:"type" yaml:"type"`
    Description string `json:"description,omitempty" yaml:"description,omitempty"`
    Required    bool   `json:"required" yaml:"required"`
}
```

# prompt

```go
import "github.com/contexis-cmp/contexis/src/core/prompt"
```

Package prompt provides the core prompt management functionality for the CMP framework.

The prompt package implements pure templates that are hydrated at runtime with context, memory, and user data. It provides a structured approach to prompt engineering with versioning, validation, and template management capabilities.

Key Features:

- Template\-based prompt generation
- Variable substitution and validation
- Content\-based versioning with SHA\-256 hashing
- JSON/YAML serialization support
- Built\-in template examples for common use cases

Example Usage:

```
// Create a new prompt
prompt := prompt.New("customer_response", "1.0.0", "Hello {{.name}}, how can I help you?")

// Render with data
result, err := prompt.Render(map[string]interface{}{
	"name": "John",
})

// Validate prompt
err = prompt.Validate()
```

## Index

- [Constants](<#constants>)
- [type Prompt](<#Prompt>)
  - [func FromJSON\(data \[\]byte\) \(\*Prompt, error\)](<#FromJSON>)
  - [func New\(name, version, template string\) \*Prompt](<#New>)
  - [func \(p \*Prompt\) AddVariable\(name, varType string, required bool, description string\)](<#Prompt.AddVariable>)
  - [func \(p \*Prompt\) GetSHA\(\) \(string, error\)](<#Prompt.GetSHA>)
  - [func \(p \*Prompt\) Render\(data map\[string\]interface\{\}\) \(string, error\)](<#Prompt.Render>)
  - [func \(p \*Prompt\) ToJSON\(\) \(\[\]byte, error\)](<#Prompt.ToJSON>)
  - [func \(p \*Prompt\) Validate\(\) error](<#Prompt.Validate>)
- [type PromptConfig](<#PromptConfig>)
- [type Variable](<#Variable>)


## Constants

<a name="RAGResponseTemplate"></a>Example templates for common use cases

```go
const (
    // RAG response template provides a structured format for RAG system responses
    RAGResponseTemplate = `# {{.component_name}} Response

**User Query:** {{.user_query}}

**Retrieved Context:**
{{range .knowledge_results}}
### Document {{.index}}: {{.title}}
{{.content}}

---
{{end}}

**Response:**
Based on the retrieved documents, here is the answer to your question:

{{.response}}

**Sources:**
{{range .knowledge_results}}
- {{.title}} (relevance: {{.relevance_score}})
{{end}}`

    // Agent conversation template provides a format for conversational AI responses
    AgentConversationTemplate = `# {{.agent_name}} Conversation

**Context:** {{.conversation_context}}

**User Message:** {{.user_message}}

**Agent Response:**
{{.agent_response}}

**Next Actions:**
{{range .suggested_actions}}
- {{.action}}: {{.description}}
{{end}}`

    // Workflow step template provides a format for workflow step execution
    WorkflowStepTemplate = `# {{.workflow_name}} - Step {{.step_number}}: {{.step_name}}

**Input:** {{.step_input}}

**Processing:**
{{.step_processing}}

**Output:** {{.step_output}}

**Status:** {{.step_status}}
{{if .step_error}}
**Error:** {{.step_error}}
{{end}}`
)
```

<a name="Prompt"></a>
## type [Prompt](<https://github.com/contexis-cmp/contexis/blob/main/src/core/prompt/prompt.go#L41-L68>)

Prompt represents pure templates hydrated at runtime in the CMP framework. It provides a structured way to manage prompt templates with versioning, validation, and rendering capabilities.

```go
type Prompt struct {
    // Name is the unique identifier for the prompt
    Name string `json:"name" yaml:"name"`

    // Version follows semantic versioning (e.g., "1.0.0")
    Version string `json:"version" yaml:"version"`

    // Description provides human-readable information about the prompt
    Description string `json:"description,omitempty" yaml:"description,omitempty"`

    // Template contains the raw template text with placeholders
    Template string `json:"template" yaml:"template"`

    // Variables defines the expected template variables and their types
    Variables []Variable `json:"variables,omitempty" yaml:"variables,omitempty"`

    // Config contains prompt behavior configuration
    Config PromptConfig `json:"config" yaml:"config"`

    // CreatedAt is the timestamp when the prompt was created
    CreatedAt time.Time `json:"created_at" yaml:"created_at"`

    // UpdatedAt is the timestamp when the prompt was last modified
    UpdatedAt time.Time `json:"updated_at" yaml:"updated_at"`

    // Metadata contains additional key-value pairs for extensibility
    Metadata map[string]string `json:"metadata,omitempty" yaml:"metadata,omitempty"`
}
```

<a name="FromJSON"></a>
### func [FromJSON](<https://github.com/contexis-cmp/contexis/blob/main/src/core/prompt/prompt.go#L213>)

```go
func FromJSON(data []byte) (*Prompt, error)
```

FromJSON creates a prompt from JSON data. It deserializes JSON data into a prompt structure.

Parameters:

- data: JSON bytes representing a prompt

Returns:

- \*Prompt: Deserialized prompt instance
- error: Any error that occurred during deserialization

<a name="New"></a>
### func [New](<https://github.com/contexis-cmp/contexis/blob/main/src/core/prompt/prompt.go#L115>)

```go
func New(name, version, template string) *Prompt
```

New creates a new Prompt with default values. It initializes a prompt with sensible defaults and timestamps.

Parameters:

- name: Unique identifier for the prompt
- version: Semantic version string
- template: Raw template text with placeholders

Returns:

- \*Prompt: A new prompt instance with default configuration

<a name="Prompt.AddVariable"></a>
### func \(\*Prompt\) [AddVariable](<https://github.com/contexis-cmp/contexis/blob/main/src/core/prompt/prompt.go#L165>)

```go
func (p *Prompt) AddVariable(name, varType string, required bool, description string)
```

AddVariable adds a new template variable to the prompt. It provides a convenient way to define expected variables with their types and requirements for validation purposes.

Parameters:

- name: Variable identifier
- varType: Variable type \("string", "context", "memory", "user"\)
- required: Whether the variable is mandatory
- description: Human\-readable description of the variable

<a name="Prompt.GetSHA"></a>
### func \(\*Prompt\) [GetSHA](<https://github.com/contexis-cmp/contexis/blob/main/src/core/prompt/prompt.go#L228>)

```go
func (p *Prompt) GetSHA() (string, error)
```

GetSHA returns a content\-based hash for versioning. It generates a SHA\-256 hash of the prompt's JSON representation to enable content\-based versioning and change detection.

Returns:

- string: SHA\-256 hash prefixed with "sha256:"
- error: Any error that occurred during hashing

<a name="Prompt.Render"></a>
### func \(\*Prompt\) [Render](<https://github.com/contexis-cmp/contexis/blob/main/src/core/prompt/prompt.go#L142>)

```go
func (p *Prompt) Render(data map[string]interface{}) (string, error)
```

Render hydrates the template with provided data. It processes the template using Go's text/template engine and returns the rendered string with all placeholders replaced.

Parameters:

- data: Map of variable names to values for template substitution

Returns:

- string: The rendered template with all placeholders replaced
- error: Any error that occurred during template processing

<a name="Prompt.ToJSON"></a>
### func \(\*Prompt\) [ToJSON](<https://github.com/contexis-cmp/contexis/blob/main/src/core/prompt/prompt.go#L200>)

```go
func (p *Prompt) ToJSON() ([]byte, error)
```

ToJSON converts the prompt to JSON format. It serializes the prompt structure to JSON for storage or transmission.

Returns:

- \[\]byte: JSON representation of the prompt
- error: Any error that occurred during serialization

<a name="Prompt.Validate"></a>
### func \(\*Prompt\) [Validate](<https://github.com/contexis-cmp/contexis/blob/main/src/core/prompt/prompt.go#L181>)

```go
func (p *Prompt) Validate() error
```

Validate ensures the prompt is properly configured. It checks that all required fields are present and valid according to the prompt schema and business rules.

Returns:

- error: Validation error if the prompt is invalid, nil otherwise

<a name="PromptConfig"></a>
## type [PromptConfig](<https://github.com/contexis-cmp/contexis/blob/main/src/core/prompt/prompt.go#L91-L103>)

PromptConfig defines prompt behavior and rendering configuration. It controls how templates are processed and what output format is expected.

```go
type PromptConfig struct {
    // MaxTokens limits the maximum number of tokens in the rendered output
    MaxTokens int `json:"max_tokens" yaml:"max_tokens"`

    // Temperature controls randomness in AI model responses (0.0 to 1.0)
    Temperature float64 `json:"temperature" yaml:"temperature"`

    // Format specifies the output format: "json", "markdown", "text"
    Format string `json:"format,omitempty" yaml:"format,omitempty"`

    // Language specifies the language for the prompt content
    Language string `json:"language,omitempty" yaml:"language,omitempty"`
}
```

<a name="Variable"></a>
## type [Variable](<https://github.com/contexis-cmp/contexis/blob/main/src/core/prompt/prompt.go#L72-L87>)

Variable defines a template variable with type information and validation rules. It provides structure for template variables to ensure proper usage and validation.

```go
type Variable struct {
    // Name is the variable identifier used in templates
    Name string `json:"name" yaml:"name"`

    // Type defines the variable type: "string", "context", "memory", "user"
    Type string `json:"type" yaml:"type"`

    // Required indicates if the variable must be provided during rendering
    Required bool `json:"required" yaml:"required"`

    // Description provides human-readable information about the variable
    Description string `json:"description,omitempty" yaml:"description,omitempty"`

    // Default provides a fallback value if the variable is not provided
    Default string `json:"default,omitempty" yaml:"default,omitempty"`
}
```

# schema

```go
import "github.com/contexis-cmp/contexis/src/core/schema"
```

Package schema provides validation utilities for Contexis context files.

It includes lightweight YAML checks and optional JSON Schema validation for \`.ctx\` files used to define agent contexts.

## Index

- [func JSONMarshal\(v interface\{\}\) \(\[\]byte, error\)](<#JSONMarshal>)
- [func ValidateContextYAML\(yamlBytes \[\]byte\) error](<#ValidateContextYAML>)


<a name="JSONMarshal"></a>
## func [JSONMarshal](<https://github.com/contexis-cmp/contexis/blob/main/src/core/schema/validator.go#L63>)

```go
func JSONMarshal(v interface{}) ([]byte, error)
```

JSONMarshal marshals any value to JSON bytes.

<a name="ValidateContextYAML"></a>
## func [ValidateContextYAML](<https://github.com/contexis-cmp/contexis/blob/main/src/core/schema/validator.go#L18>)

```go
func ValidateContextYAML(yamlBytes []byte) error
```

ValidateContextYAML performs a lightweight validation of a \`.ctx\` YAML file.

The function ensures required top\-level fields exist and have expected types. If a JSON Schema is present at \`src/core/schema/context\_schema.json\`, it validates against that schema; otherwise it falls back to basic checks.

# registry

```go
import "github.com/contexis-cmp/contexis/src/plugins/registry"
```

Package registry provides discovery and lifecycle management for Contexis plugins.

Plugins are declared with a \`plugin.json\` manifest under \`plugins/\<name\>/\` and can advertise capabilities \(e.g., memory backends, tools, providers\). The Registry scans, installs, and removes plugin packages at runtime or via CLI.

## Index

- [func IsKnownCapability\(cap string\) bool](<#IsKnownCapability>)
- [func ListCapabilities\(\) \[\]string](<#ListCapabilities>)
- [type Manifest](<#Manifest>)
- [type Plugin](<#Plugin>)
- [type Registry](<#Registry>)
  - [func NewRegistry\(root string\) \*Registry](<#NewRegistry>)
  - [func \(r \*Registry\) Info\(name string\) \(\*Plugin, error\)](<#Registry.Info>)
  - [func \(r \*Registry\) Install\(src string\) \(Plugin, error\)](<#Registry.Install>)
  - [func \(r \*Registry\) InstallRemote\(src string\) \(Plugin, error\)](<#Registry.InstallRemote>)
  - [func \(r \*Registry\) List\(\) \(\[\]Plugin, error\)](<#Registry.List>)
  - [func \(r \*Registry\) Remove\(name string\) error](<#Registry.Remove>)


<a name="IsKnownCapability"></a>
## func [IsKnownCapability](<https://github.com/contexis-cmp/contexis/blob/main/src/plugins/registry/capability_registry.go#L24>)

```go
func IsKnownCapability(cap string) bool
```

IsKnownCapability returns true if cap is in the registry.

<a name="ListCapabilities"></a>
## func [ListCapabilities](<https://github.com/contexis-cmp/contexis/blob/main/src/plugins/registry/capability_registry.go#L30>)

```go
func ListCapabilities() []string
```

ListCapabilities returns the known capability keys.

<a name="Manifest"></a>
## type [Manifest](<https://github.com/contexis-cmp/contexis/blob/main/src/plugins/registry/registry.go#L26-L33>)

Manifest describes a plugin package.

The manifest is stored at \`plugins/\<name\>/plugin.json\` and controls discoverability and capability declaration. Example:

```
{
  "name": "re_ranker",
  "version": "0.1.14",
  "description": "Reranking component for RAG",
  "capabilities": ["memory:rerank"],
  "compatibility": {"cmp_min": "0.1.14"}
}
```

```go
type Manifest struct {
    Name          string            `json:"name"`
    Version       string            `json:"version"`
    Description   string            `json:"description"`
    Capabilities  []string          `json:"capabilities"`
    Compatibility map[string]string `json:"compatibility"`
    Signature     string            `json:"signature,omitempty"` // optional detached signature (hex/base64)
}
```

<a name="Plugin"></a>
## type [Plugin](<https://github.com/contexis-cmp/contexis/blob/main/src/plugins/registry/registry.go#L36-L39>)

Plugin represents a discovered plugin on disk.

```go
type Plugin struct {
    Path     string
    Manifest Manifest
}
```

<a name="Registry"></a>
## type [Registry](<https://github.com/contexis-cmp/contexis/blob/main/src/plugins/registry/registry.go#L42-L44>)

Registry loads and manages plugins rooted at a project directory.

```go
type Registry struct {
    // contains filtered or unexported fields
}
```

<a name="NewRegistry"></a>
### func [NewRegistry](<https://github.com/contexis-cmp/contexis/blob/main/src/plugins/registry/registry.go#L47>)

```go
func NewRegistry(root string) *Registry
```

NewRegistry creates a new Registry reading from \`\<root\>/plugins\`.

<details><summary>Example</summary>
<p>



```go
r := NewRegistry(".")
list, err := r.List()
fmt.Println(err == nil && (len(list) >= 0))
// Output:
// true
```

#### Output

```
true
```

</p>
</details>

<a name="Registry.Info"></a>
### func \(\*Registry\) [Info](<https://github.com/contexis-cmp/contexis/blob/main/src/plugins/registry/registry.go#L86>)

```go
func (r *Registry) Info(name string) (*Plugin, error)
```

Info returns a single plugin manifest by name.

<details><summary>Example</summary>
<p>



```go
r := NewRegistry(".")
_, err := r.Info("nonexistent")
fmt.Println(err != nil)
// Output:
// true
```

#### Output

```
true
```

</p>
</details>

<a name="Registry.Install"></a>
### func \(\*Registry\) [Install](<https://github.com/contexis-cmp/contexis/blob/main/src/plugins/registry/registry.go#L100>)

```go
func (r *Registry) Install(src string) (Plugin, error)
```

Install copies a plugin directory from src into \`plugins/\<name\>\`.

<a name="Registry.InstallRemote"></a>
### func \(\*Registry\) [InstallRemote](<https://github.com/contexis-cmp/contexis/blob/main/src/plugins/registry/remote.go#L20>)

```go
func (r *Registry) InstallRemote(src string) (Plugin, error)
```

InstallRemote fetches a plugin from a URL or Git repo and installs it. Supported sources: \- HTTPS zip archive URL \(must contain plugin.json at root or in a top\-level folder\) \- Git repo URL \(requires git installed\); optional ref via \#ref

<a name="Registry.List"></a>
### func \(\*Registry\) [List](<https://github.com/contexis-cmp/contexis/blob/main/src/plugins/registry/registry.go#L52>)

```go
func (r *Registry) List() ([]Plugin, error)
```

List scans the plugins directory and returns parsed plugin manifests.

<a name="Registry.Remove"></a>
### func \(\*Registry\) [Remove](<https://github.com/contexis-cmp/contexis/blob/main/src/plugins/registry/registry.go#L130>)

```go
func (r *Registry) Remove(name string) error
```

Remove deletes \`plugins/\<name\>\` recursively.

# runtimecontext

```go
import "github.com/contexis-cmp/contexis/src/runtime/context"
```

## Index

- [func DeepMerge\(dst, src map\[string\]interface\{\}\) map\[string\]interface\{\}](<#DeepMerge>)
- [type ContextService](<#ContextService>)
  - [func NewContextService\(projectRoot string\) \*ContextService](<#NewContextService>)
  - [func \(s \*ContextService\) ReloadContext\(\_ string\) error](<#ContextService.ReloadContext>)
  - [func \(s \*ContextService\) ResolveContext\(tenantID, contextName string\) \(\*corectx.Context, error\)](<#ContextService.ResolveContext>)


<a name="DeepMerge"></a>
## func [DeepMerge](<https://github.com/contexis-cmp/contexis/blob/main/src/runtime/context/service.go#L274>)

```go
func DeepMerge(dst, src map[string]interface{}) map[string]interface{}
```

DeepMerge merges src into dst recursively. Lists are unioned by value; maps are deep\-merged; scalars override.

<a name="ContextService"></a>
## type [ContextService](<https://github.com/contexis-cmp/contexis/blob/main/src/runtime/context/service.go#L18-L22>)

ContextService is responsible for resolving, validating, and caching contexts.

```go
type ContextService struct {
    // contains filtered or unexported fields
}
```

<a name="NewContextService"></a>
### func [NewContextService](<https://github.com/contexis-cmp/contexis/blob/main/src/runtime/context/service.go#L25>)

```go
func NewContextService(projectRoot string) *ContextService
```

NewContextService creates a new ContextService instance.

<a name="ContextService.ReloadContext"></a>
### func \(\*ContextService\) [ReloadContext](<https://github.com/contexis-cmp/contexis/blob/main/src/runtime/context/service.go#L114>)

```go
func (s *ContextService) ReloadContext(_ string) error
```

ReloadContext clears the cache so subsequent calls re\-read from disk. If a path is supplied, this is currently a no\-op beyond clearing the cache.

<a name="ContextService.ResolveContext"></a>
### func \(\*ContextService\) [ResolveContext](<https://github.com/contexis-cmp/contexis/blob/main/src/runtime/context/service.go#L36>)

```go
func (s *ContextService) ResolveContext(tenantID, contextName string) (*corectx.Context, error)
```

ResolveContext loads, validates, and returns a Context for a tenant and context name. Resolution order: 1\) contexts/tenants/\<tenantID\>/\<contextName\>.ctx 2\) contexts/\<contextName\>/\*.ctx \(first .ctx file found in that directory\)

# guardrails

```go
import "github.com/contexis-cmp/contexis/src/runtime/guardrails"
```

## Index

- [func EnforceGuardrails\(ctx \*corectx.Context, response string\) \(string, error\)](<#EnforceGuardrails>)
- [func ValidateCapabilities\(ctx \*corectx.Context, requestedAction string\) error](<#ValidateCapabilities>)


<a name="EnforceGuardrails"></a>
## func [EnforceGuardrails](<https://github.com/contexis-cmp/contexis/blob/main/src/runtime/guardrails/enforcer.go#L32>)

```go
func EnforceGuardrails(ctx *corectx.Context, response string) (string, error)
```

EnforceGuardrails applies guardrail constraints to a candidate response.

It enforces:

- Response format \(json|markdown|text\)
- Token length \(MaxTokens\)

Tone and temperature are advisory and not enforced at this stage.

<details><summary>Example</summary>
<p>



```go
ctx := &corectx.Context{Guardrails: corectx.Guardrails{Format: "text", MaxTokens: 3}}
out, err := EnforceGuardrails(ctx, "one two three four five")
fmt.Println(err == nil && out == "one two three ...")
// Output:
// true
```

#### Output

```
true
```

</p>
</details>

<a name="ValidateCapabilities"></a>
## func [ValidateCapabilities](<https://github.com/contexis-cmp/contexis/blob/main/src/runtime/guardrails/enforcer.go#L13>)

```go
func ValidateCapabilities(ctx *corectx.Context, requestedAction string) error
```

ValidateCapabilities returns an error if requestedAction is not permitted by the Context's role capabilities. An empty action is treated as allowed.

<details><summary>Example</summary>
<p>



```go
ctx := &corectx.Context{Role: corectx.Role{Capabilities: []string{"search", "answer"}}}
err := ValidateCapabilities(ctx, "search")
fmt.Println(err == nil)
// Output:
// true
```

#### Output

```
true
```

</p>
</details>

# runtimememory

```go
import "github.com/contexis-cmp/contexis/src/runtime/memory"
```

## Index

- [func DerivePath\(root, component, tenantID, subpath string\) string](<#DerivePath>)
- [func LoadComponentMemoryConfig\(cfg \*Config\) error](<#LoadComponentMemoryConfig>)
- [type Config](<#Config>)
- [type MemoryStore](<#MemoryStore>)
  - [func NewStore\(cfg Config\) \(MemoryStore, error\)](<#NewStore>)
- [type SearchResult](<#SearchResult>)


<a name="DerivePath"></a>
## func [DerivePath](<https://github.com/contexis-cmp/contexis/blob/main/src/runtime/memory/service.go#L36>)

```go
func DerivePath(root, component, tenantID, subpath string) string
```

DerivePath returns a tenant\-aware path under memory/.

<a name="LoadComponentMemoryConfig"></a>
## func [LoadComponentMemoryConfig](<https://github.com/contexis-cmp/contexis/blob/main/src/runtime/memory/config.go#L12>)

```go
func LoadComponentMemoryConfig(cfg *Config) error
```

LoadComponentMemoryConfig loads memory\_config.yaml for a component if present and merges into cfg.Settings.

<a name="Config"></a>
## type [Config](<https://github.com/contexis-cmp/contexis/blob/main/src/runtime/memory/service.go#L12-L19>)

Config for memory service instantiation.

```go
type Config struct {
    Provider       string            // sqlite, episodic
    RootDir        string            // project root for file-backed stores
    ComponentName  string            // e.g., CustomerDocs, SupportBot
    EmbeddingModel string            // model identifier for vector stores
    Settings       map[string]string // provider-specific settings
    TenantID       string            // tenant isolation
}
```

<a name="MemoryStore"></a>
## type [MemoryStore](<https://github.com/contexis-cmp/contexis/blob/main/src/runtime/memory/store.go#L14-L26>)

MemoryStore defines the interface for memory providers.

```go
type MemoryStore interface {
    // IngestDocuments ingests raw text documents and returns a version identifier (e.g., memory SHA).
    IngestDocuments(ctx context.Context, documents []string) (string, error)

    // Search performs a semantic search and returns the top results.
    Search(ctx context.Context, query string, topK int) ([]SearchResult, error)

    // Optimize performs any maintenance/compaction tasks.
    Optimize(ctx context.Context, memoryVersion string) error

    // Close releases resources.
    Close() error
}
```

<a name="NewStore"></a>
### func [NewStore](<https://github.com/contexis-cmp/contexis/blob/main/src/runtime/memory/service.go#L22>)

```go
func NewStore(cfg Config) (MemoryStore, error)
```

NewStore creates a MemoryStore based on config.

<a name="SearchResult"></a>
## type [SearchResult](<https://github.com/contexis-cmp/contexis/blob/main/src/runtime/memory/store.go#L6-L11>)

SearchResult represents a single search match from a memory store.

```go
type SearchResult struct {
    ID       string                 `json:"id"`
    Content  string                 `json:"content"`
    Score    float64                `json:"score"`
    Metadata map[string]interface{} `json:"metadata,omitempty"`
}
```

# model

```go
import "github.com/contexis-cmp/contexis/src/runtime/model"
```

Package model defines the model provider abstraction used by the runtime.

Providers implement text generation over rendered prompts. A factory reads environment variables to select a concrete implementation \(e.g. Hugging Face Inference API\), or returns nil when no provider is configured.

## Index

- [type HuggingFaceAPIProvider](<#HuggingFaceAPIProvider>)
  - [func NewHuggingFaceAPIProviderFromEnv\(\) \(\*HuggingFaceAPIProvider, error\)](<#NewHuggingFaceAPIProviderFromEnv>)
  - [func \(p \*HuggingFaceAPIProvider\) Generate\(ctx context.Context, input string, params Params\) \(string, error\)](<#HuggingFaceAPIProvider.Generate>)
- [type Params](<#Params>)
- [type Provider](<#Provider>)
  - [func FromEnv\(\) \(Provider, error\)](<#FromEnv>)
  - [func NewLocalProviderFromEnv\(\) \(Provider, error\)](<#NewLocalProviderFromEnv>)


<a name="HuggingFaceAPIProvider"></a>
## type [HuggingFaceAPIProvider](<https://github.com/contexis-cmp/contexis/blob/main/src/runtime/model/hf_provider.go#L14-L19>)

HuggingFaceAPIProvider calls the HF Inference API for text generation.

```go
type HuggingFaceAPIProvider struct {
    // contains filtered or unexported fields
}
```

<a name="NewHuggingFaceAPIProviderFromEnv"></a>
### func [NewHuggingFaceAPIProviderFromEnv](<https://github.com/contexis-cmp/contexis/blob/main/src/runtime/model/hf_provider.go#L21>)

```go
func NewHuggingFaceAPIProviderFromEnv() (*HuggingFaceAPIProvider, error)
```



<a name="HuggingFaceAPIProvider.Generate"></a>
### func \(\*HuggingFaceAPIProvider\) [Generate](<https://github.com/contexis-cmp/contexis/blob/main/src/runtime/model/hf_provider.go#L48>)

```go
func (p *HuggingFaceAPIProvider) Generate(ctx context.Context, input string, params Params) (string, error)
```



<a name="Params"></a>
## type [Params](<https://github.com/contexis-cmp/contexis/blob/main/src/runtime/model/provider.go#L7-L12>)

Params defines model generation parameters that influence decoding. Fields may be ignored by providers that do not support them.

```go
type Params struct {
    Temperature   float64 // Sampling temperature
    TopP          float64 // Nucleus sampling probability
    MaxNewTokens  int     // Maximum number of new tokens to generate
    RepetitionPen float64 // Repetition penalty
}
```

<details><summary>Example</summary>
<p>



```go
p := Params{Temperature: 0.2, TopP: 0.9, MaxNewTokens: 64, RepetitionPen: 1.1}
fmt.Println(p.MaxNewTokens)
// Output:
// 64
```

#### Output

```
64
```

</p>
</details>

<a name="Provider"></a>
## type [Provider](<https://github.com/contexis-cmp/contexis/blob/main/src/runtime/model/provider.go#L16-L18>)

Provider defines an inference provider capable of generating text based on a rendered prompt and parameter set.

```go
type Provider interface {
    Generate(ctx context.Context, input string, params Params) (string, error)
}
```

<a name="FromEnv"></a>
### func [FromEnv](<https://github.com/contexis-cmp/contexis/blob/main/src/runtime/model/factory.go#L9>)

```go
func FromEnv() (Provider, error)
```

FromEnv returns a Provider when environment variables are configured, or nil when no provider is configured. Supported variables:

- Local first via CMP\_LOCAL\_MODELS=true \(uses local provider\)
- HF\_TOKEN, HF\_MODEL\_ID\[, HF\_ENDPOINT\] for Hugging Face Inference API.

<details><summary>Example</summary>
<p>



```go
prov, _ := FromEnv()
fmt.Println(prov == nil || prov != nil)
// Output:
// true
```

#### Output

```
true
```

</p>
</details>

<a name="NewLocalProviderFromEnv"></a>
### func [NewLocalProviderFromEnv](<https://github.com/contexis-cmp/contexis/blob/main/src/runtime/model/provider.go#L22>)

```go
func NewLocalProviderFromEnv() (Provider, error)
```

NewLocalProviderFromEnv returns a Provider backed by a local Python process when local\-first variables are enabled. Implementation provided in local\_provider.go.

# runtimeprompt

```go
import "github.com/contexis-cmp/contexis/src/runtime/prompt"
```

## Index

- [func OptimizeTokens\(content string, maxTokens int\) string](<#OptimizeTokens>)
- [func ValidateFormat\(format, response string\) error](<#ValidateFormat>)
- [type Engine](<#Engine>)
  - [func NewEngine\(projectRoot string\) \*Engine](<#NewEngine>)
  - [func \(e \*Engine\) RenderFile\(component string, relPath string, data map\[string\]interface\{\}\) \(string, error\)](<#Engine.RenderFile>)


<a name="OptimizeTokens"></a>
## func [OptimizeTokens](<https://github.com/contexis-cmp/contexis/blob/main/src/runtime/prompt/engine.go#L96>)

```go
func OptimizeTokens(content string, maxTokens int) string
```

OptimizeTokens trims content to at most maxTokens using a naive whitespace tokenization.

<details><summary>Example</summary>
<p>



```go
out := OptimizeTokens("one two three four five", 3)
fmt.Println(out)
// Output:
// one two three ...
```

#### Output

```
one two three ...
```

</p>
</details>

<a name="ValidateFormat"></a>
## func [ValidateFormat](<https://github.com/contexis-cmp/contexis/blob/main/src/runtime/prompt/engine.go#L109>)

```go
func ValidateFormat(format, response string) error
```

ValidateFormat validates response against expected format. If format == "json", checks JSON. If format == "markdown", ensures non\-empty and at least one newline.

<details><summary>Example</summary>
<p>



```go
err := ValidateFormat("text", "hello")
fmt.Println(err == nil)
// Output:
// true
```

#### Output

```
true
```

</p>
</details>

<a name="Engine"></a>
## type [Engine](<https://github.com/contexis-cmp/contexis/blob/main/src/runtime/prompt/engine.go#L14-L18>)

Engine loads, compiles, caches, renders, and validates prompt templates.

```go
type Engine struct {
    // contains filtered or unexported fields
}
```

<a name="NewEngine"></a>
### func [NewEngine](<https://github.com/contexis-cmp/contexis/blob/main/src/runtime/prompt/engine.go#L20>)

```go
func NewEngine(projectRoot string) *Engine
```



<a name="Engine.RenderFile"></a>
### func \(\*Engine\) [RenderFile](<https://github.com/contexis-cmp/contexis/blob/main/src/runtime/prompt/engine.go#L25>)

```go
func (e *Engine) RenderFile(component string, relPath string, data map[string]interface{}) (string, error)
```

RenderFile renders a template file in prompts/\<component\>/... with the provided data.

<details><summary>Example</summary>
<p>



```go
eng := NewEngine(".")
// This example assumes a simple prompt exists; we demonstrate API usage only.
_, err := eng.RenderFile("SupportBot", "agent_response.md", map[string]interface{}{"UserQuery": "hello"})
fmt.Println(err == nil || err != nil)
// Output:
// true
```

#### Output

```
true
```

</p>
</details>

# security

```go
import "github.com/contexis-cmp/contexis/src/runtime/security"
```

## Index

- [Variables](<#variables>)
- [func CheckPermission\(p \*Principal, r Resource, a Action\) bool](<#CheckPermission>)
- [func DecryptGCM\(key, data \[\]byte\) \(\[\]byte, error\)](<#DecryptGCM>)
- [func DetectPII\(s string\) bool](<#DetectPII>)
- [func EncryptGCM\(key, plaintext \[\]byte\) \(\[\]byte, error\)](<#EncryptGCM>)
- [func ExtractIP\(r \*http.Request\) string](<#ExtractIP>)
- [func HasScope\(p \*Principal, scope string\) bool](<#HasScope>)
- [func RedactPII\(s string\) string](<#RedactPII>)
- [func RetryAfter\(\) string](<#RetryAfter>)
- [func SanitizeUserInput\(text string\) string](<#SanitizeUserInput>)
- [func WithPrincipal\(ctx context.Context, p \*Principal\) context.Context](<#WithPrincipal>)
- [type APIKey](<#APIKey>)
- [type APIKeyStore](<#APIKeyStore>)
  - [func NewAPIKeyStoreFromEnv\(\) \*APIKeyStore](<#NewAPIKeyStoreFromEnv>)
  - [func \(s \*APIKeyStore\) Authenticate\(r \*http.Request\) \(\*Principal, error\)](<#APIKeyStore.Authenticate>)
- [type Action](<#Action>)
- [type AuditEvent](<#AuditEvent>)
- [type AuditSink](<#AuditSink>)
- [type Auditor](<#Auditor>)
  - [func NewAuditor\(sink AuditSink\) \*Auditor](<#NewAuditor>)
  - [func \(a \*Auditor\) Record\(ctx context.Context, ev AuditEvent\)](<#Auditor.Record>)
- [type EnvKeyProvider](<#EnvKeyProvider>)
  - [func \(EnvKeyProvider\) GetKey\(tenantID string\) \(\[\]byte, error\)](<#EnvKeyProvider.GetKey>)
- [type JSONFileSink](<#JSONFileSink>)
  - [func NewJSONFileSink\(path string\) \*JSONFileSink](<#NewJSONFileSink>)
  - [func \(s \*JSONFileSink\) Write\(e AuditEvent\) error](<#JSONFileSink.Write>)
- [type KeyProvider](<#KeyProvider>)
- [type LimiterKey](<#LimiterKey>)
- [type Policy](<#Policy>)
  - [func DefaultPolicy\(\) Policy](<#DefaultPolicy>)
  - [func \(p Policy\) MergeEnv\(\) Policy](<#Policy.MergeEnv>)
  - [func \(p Policy\) RequiresOutOfBand\(action string\) bool](<#Policy.RequiresOutOfBand>)
- [type Principal](<#Principal>)
  - [func FromPrincipal\(ctx context.Context\) \(\*Principal, bool\)](<#FromPrincipal>)
- [type PromptRisk](<#PromptRisk>)
  - [func ClassifyPromptRisk\(text string, extras ...string\) PromptRisk](<#ClassifyPromptRisk>)
- [type RateLimiter](<#RateLimiter>)
  - [func NewRateLimiter\(r rate.Limit, b int\) \*RateLimiter](<#NewRateLimiter>)
  - [func \(rl \*RateLimiter\) Allow\(k LimiterKey, perMinuteOverride int\) bool](<#RateLimiter.Allow>)
- [type Resource](<#Resource>)


## Variables

<a name="PromptInjectionDetections"></a>

```go
var (
    PromptInjectionDetections = prometheus.NewCounter(prometheus.CounterOpts{
        Name: "cmp_security_prompt_injection_detections_total",
        Help: "Total number of detected potential prompt injection attempts.",
    })
    PolicyViolations = prometheus.NewCounter(prometheus.CounterOpts{
        Name: "cmp_security_policy_violations_total",
        Help: "Total number of responses blocked due to policy violations.",
    })
    BlockedResponses = prometheus.NewCounter(prometheus.CounterOpts{
        Name: "cmp_security_blocked_responses_total",
        Help: "Total number of blocked responses.",
    })
)
```

<a name="CheckPermission"></a>
## func [CheckPermission](<https://github.com/contexis-cmp/contexis/blob/main/src/runtime/security/rbac.go#L23>)

```go
func CheckPermission(p *Principal, r Resource, a Action) bool
```

CheckPermission validates if principal has permission on resource

<a name="DecryptGCM"></a>
## func [DecryptGCM](<https://github.com/contexis-cmp/contexis/blob/main/src/runtime/security/crypto.go#L64>)

```go
func DecryptGCM(key, data []byte) ([]byte, error)
```

DecryptGCM decrypts data produced by EncryptGCM

<a name="DetectPII"></a>
## func [DetectPII](<https://github.com/contexis-cmp/contexis/blob/main/src/runtime/security/prompt_guard.go#L69>)

```go
func DetectPII(s string) bool
```

DetectPII returns true if content likely contains PII

<a name="EncryptGCM"></a>
## func [EncryptGCM](<https://github.com/contexis-cmp/contexis/blob/main/src/runtime/security/crypto.go#L43>)

```go
func EncryptGCM(key, plaintext []byte) ([]byte, error)
```

EncryptGCM encrypts plaintext with AES\-GCM using the provided key

<a name="ExtractIP"></a>
## func [ExtractIP](<https://github.com/contexis-cmp/contexis/blob/main/src/runtime/security/ratelimit.go#L56>)

```go
func ExtractIP(r *http.Request) string
```

ExtractIP returns the remote IP from request

<a name="HasScope"></a>
## func [HasScope](<https://github.com/contexis-cmp/contexis/blob/main/src/runtime/security/auth.go#L156>)

```go
func HasScope(p *Principal, scope string) bool
```

HasScope returns true if the principal has the given scope

<a name="RedactPII"></a>
## func [RedactPII](<https://github.com/contexis-cmp/contexis/blob/main/src/runtime/security/prompt_guard.go#L77>)

```go
func RedactPII(s string) string
```

RedactPII replaces likely PII with placeholders

<a name="RetryAfter"></a>
## func [RetryAfter](<https://github.com/contexis-cmp/contexis/blob/main/src/runtime/security/ratelimit.go#L105>)

```go
func RetryAfter() string
```

Retry\-After calculation helper \(1 second default\)

<a name="SanitizeUserInput"></a>
## func [SanitizeUserInput](<https://github.com/contexis-cmp/contexis/blob/main/src/runtime/security/prompt_guard.go#L50>)

```go
func SanitizeUserInput(text string) string
```

SanitizeUserInput strips or neutralizes model\-directed instructions in user\-provided text

<a name="WithPrincipal"></a>
## func [WithPrincipal](<https://github.com/contexis-cmp/contexis/blob/main/src/runtime/security/auth.go#L145>)

```go
func WithPrincipal(ctx context.Context, p *Principal) context.Context
```

WithPrincipal stores the principal in context

<a name="APIKey"></a>
## type [APIKey](<https://github.com/contexis-cmp/contexis/blob/main/src/runtime/security/auth.go#L23-L29>)

APIKey represents an API key entry in the keystore

```go
type APIKey struct {
    KeyID     string   `json:"key_id"`
    Hash      string   `json:"hash"`       // hex-encoded SHA-256 of the token
    TenantID  string   `json:"tenant_id"`  // associated tenant
    Scopes    []string `json:"scopes"`     // permissions like "chat:invoke", "context:read"
    RateLimit int      `json:"rate_limit"` // requests per minute (optional)
}
```

<a name="APIKeyStore"></a>
## type [APIKeyStore](<https://github.com/contexis-cmp/contexis/blob/main/src/runtime/security/auth.go#L32-L36>)

APIKeyStore provides lookup for API keys

```go
type APIKeyStore struct {
    // contains filtered or unexported fields
}
```

<a name="NewAPIKeyStoreFromEnv"></a>
### func [NewAPIKeyStoreFromEnv](<https://github.com/contexis-cmp/contexis/blob/main/src/runtime/security/auth.go#L41>)

```go
func NewAPIKeyStoreFromEnv() *APIKeyStore
```

NewAPIKeyStoreFromEnv loads keys from env. Supports two formats: 1\) CMP\_API\_KEYS as JSON array of APIKey 2\) CMP\_API\_TOKENS as comma\-separated list of "token@tenant:scope1|scope2" \(for local dev\)

<a name="APIKeyStore.Authenticate"></a>
### func \(\*APIKeyStore\) [Authenticate](<https://github.com/contexis-cmp/contexis/blob/main/src/runtime/security/auth.go#L120>)

```go
func (s *APIKeyStore) Authenticate(r *http.Request) (*Principal, error)
```

Authenticate extracts the Bearer token and verifies it against the store

<a name="Action"></a>
## type [Action](<https://github.com/contexis-cmp/contexis/blob/main/src/runtime/security/rbac.go#L13>)

Action is an operation on a resource

```go
type Action string
```

<a name="ActionRead"></a>

```go
const (
    ActionRead    Action = "read"
    ActionWrite   Action = "write"
    ActionExecute Action = "execute"
    ActionAdmin   Action = "admin"
)
```

<a name="AuditEvent"></a>
## type [AuditEvent](<https://github.com/contexis-cmp/contexis/blob/main/src/runtime/security/audit.go#L14-L24>)

AuditEvent represents a compliance\-grade audit record

```go
type AuditEvent struct {
    Timestamp  time.Time              `json:"timestamp"`
    RequestID  string                 `json:"request_id"`
    TenantID   string                 `json:"tenant_id"`
    ActorKeyID string                 `json:"actor_key_id"`
    Action     string                 `json:"action"`
    Resource   string                 `json:"resource"`
    Result     string                 `json:"result"` // allowed|denied|error|success|failure
    Reason     string                 `json:"reason,omitempty"`
    Attributes map[string]interface{} `json:"attributes,omitempty"`
}
```

<a name="AuditSink"></a>
## type [AuditSink](<https://github.com/contexis-cmp/contexis/blob/main/src/runtime/security/audit.go#L27-L29>)

AuditSink writes audit events to durable storage

```go
type AuditSink interface {
    Write(AuditEvent) error
}
```

<a name="Auditor"></a>
## type [Auditor](<https://github.com/contexis-cmp/contexis/blob/main/src/runtime/security/audit.go#L56-L58>)

Auditor routes audit events to both structured logs and sink

```go
type Auditor struct {
    // contains filtered or unexported fields
}
```

<a name="NewAuditor"></a>
### func [NewAuditor](<https://github.com/contexis-cmp/contexis/blob/main/src/runtime/security/audit.go#L60>)

```go
func NewAuditor(sink AuditSink) *Auditor
```



<a name="Auditor.Record"></a>
### func \(\*Auditor\) [Record](<https://github.com/contexis-cmp/contexis/blob/main/src/runtime/security/audit.go#L62>)

```go
func (a *Auditor) Record(ctx context.Context, ev AuditEvent)
```



<a name="EnvKeyProvider"></a>
## type [EnvKeyProvider](<https://github.com/contexis-cmp/contexis/blob/main/src/runtime/security/crypto.go#L20>)

EnvKeyProvider loads key material from environment variables CMP\_EPISODIC\_KEY \(hex/base64 not required here: expect 32\-byte raw via env or we derive from sha256\)

```go
type EnvKeyProvider struct{}
```

<a name="EnvKeyProvider.GetKey"></a>
### func \(EnvKeyProvider\) [GetKey](<https://github.com/contexis-cmp/contexis/blob/main/src/runtime/security/crypto.go#L22>)

```go
func (EnvKeyProvider) GetKey(tenantID string) ([]byte, error)
```



<a name="JSONFileSink"></a>
## type [JSONFileSink](<https://github.com/contexis-cmp/contexis/blob/main/src/runtime/security/audit.go#L32-L35>)

JSONFileSink appends events to a local JSONL file \(dev only\)

```go
type JSONFileSink struct {
    // contains filtered or unexported fields
}
```

<a name="NewJSONFileSink"></a>
### func [NewJSONFileSink](<https://github.com/contexis-cmp/contexis/blob/main/src/runtime/security/audit.go#L37>)

```go
func NewJSONFileSink(path string) *JSONFileSink
```



<a name="JSONFileSink.Write"></a>
### func \(\*JSONFileSink\) [Write](<https://github.com/contexis-cmp/contexis/blob/main/src/runtime/security/audit.go#L39>)

```go
func (s *JSONFileSink) Write(e AuditEvent) error
```



<a name="KeyProvider"></a>
## type [KeyProvider](<https://github.com/contexis-cmp/contexis/blob/main/src/runtime/security/crypto.go#L13-L16>)

KeyProvider abstracts encryption key retrieval \(per\-tenant\)

```go
type KeyProvider interface {
    // GetKey returns a 32-byte key for AES-256
    GetKey(tenantID string) ([]byte, error)
}
```

<a name="LimiterKey"></a>
## type [LimiterKey](<https://github.com/contexis-cmp/contexis/blob/main/src/runtime/security/ratelimit.go#L13-L17>)

LimiterKey identifies a limiter bucket

```go
type LimiterKey struct {
    APIKeyID string
    TenantID string
    IP       string
}
```

<a name="Policy"></a>
## type [Policy](<https://github.com/contexis-cmp/contexis/blob/main/src/runtime/security/policy.go#L9-L13>)

Policy defines action gating requirements for high\-risk operations Example: map action \-\> requires\_out\_of\_band\_confirmation

```go
type Policy struct {
    RequireOOB          map[string]bool
    NoUnsupportedClaims bool   // if true, response must cite sources when memory results are used
    PIIMode             string // off|redact|block
}
```

<a name="DefaultPolicy"></a>
### func [DefaultPolicy](<https://github.com/contexis-cmp/contexis/blob/main/src/runtime/security/policy.go#L15>)

```go
func DefaultPolicy() Policy
```



<a name="Policy.MergeEnv"></a>
### func \(Policy\) [MergeEnv](<https://github.com/contexis-cmp/contexis/blob/main/src/runtime/security/policy.go#L32>)

```go
func (p Policy) MergeEnv() Policy
```

MergeEnv allows overriding policy using environment variables CMP\_OOB\_REQUIRED\_ACTIONS: comma\-separated list of actions requiring OOB \(e.g., "data\_change,account\_action,payment"\) CMP\_PII\_MODE: one of off|redact|block

<a name="Policy.RequiresOutOfBand"></a>
### func \(Policy\) [RequiresOutOfBand](<https://github.com/contexis-cmp/contexis/blob/main/src/runtime/security/policy.go#L27>)

```go
func (p Policy) RequiresOutOfBand(action string) bool
```

RequiresOutOfBand returns true if an action requires external confirmation

<a name="Principal"></a>
## type [Principal](<https://github.com/contexis-cmp/contexis/blob/main/src/runtime/security/auth.go#L16-L20>)

Principal represents an authenticated caller

```go
type Principal struct {
    KeyID    string
    TenantID string
    Scopes   []string
}
```

<a name="FromPrincipal"></a>
### func [FromPrincipal](<https://github.com/contexis-cmp/contexis/blob/main/src/runtime/security/auth.go#L150>)

```go
func FromPrincipal(ctx context.Context) (*Principal, bool)
```

FromPrincipal retrieves the principal from context

<a name="PromptRisk"></a>
## type [PromptRisk](<https://github.com/contexis-cmp/contexis/blob/main/src/runtime/security/prompt_guard.go#L9>)

PromptRisk represents a simple risk classification for inputs

```go
type PromptRisk string
```

<a name="RiskLow"></a>

```go
const (
    RiskLow    PromptRisk = "low"
    RiskMedium PromptRisk = "medium"
    RiskHigh   PromptRisk = "high"
)
```

<a name="ClassifyPromptRisk"></a>
### func [ClassifyPromptRisk](<https://github.com/contexis-cmp/contexis/blob/main/src/runtime/security/prompt_guard.go#L31>)

```go
func ClassifyPromptRisk(text string, extras ...string) PromptRisk
```

ClassifyPromptRisk applies simple heuristics to detect likely injection attempts

<a name="RateLimiter"></a>
## type [RateLimiter](<https://github.com/contexis-cmp/contexis/blob/main/src/runtime/security/ratelimit.go#L20-L25>)

RateLimiter provides token\-bucket rate limiting across multiple dimensions

```go
type RateLimiter struct {
    // contains filtered or unexported fields
}
```

<a name="NewRateLimiter"></a>
### func [NewRateLimiter](<https://github.com/contexis-cmp/contexis/blob/main/src/runtime/security/ratelimit.go#L27>)

```go
func NewRateLimiter(r rate.Limit, b int) *RateLimiter
```



<a name="RateLimiter.Allow"></a>
### func \(\*RateLimiter\) [Allow](<https://github.com/contexis-cmp/contexis/blob/main/src/runtime/security/ratelimit.go#L35>)

```go
func (rl *RateLimiter) Allow(k LimiterKey, perMinuteOverride int) bool
```



<a name="Resource"></a>
## type [Resource](<https://github.com/contexis-cmp/contexis/blob/main/src/runtime/security/rbac.go#L6-L10>)

Resource represents a protected resource

```go
type Resource struct {
    Type   string // e.g., context, memory, prompt, tool, metrics
    Name   string // component or identifier
    Tenant string // tenant scope
}
```

# server

```go
import "github.com/contexis-cmp/contexis/src/runtime/server"
```

Package server exposes the HTTP runtime for the Contexis CMP framework.

It wires health/readiness/version/metrics endpoints and the chat API \(POST /api/v1/chat\), integrating context resolution, memory search, prompt rendering, optional model inference, and optional security controls such as authentication, RBAC, rate limiting, prompt\-injection and PII policies.

## Index

- [func NewHandler\(root string\) http.Handler](<#NewHandler>)
- [func NewHandlerWithProvider\(root string, provider runtimemodel.Provider\) http.Handler](<#NewHandlerWithProvider>)
- [func Serve\(addr string\) error](<#Serve>)
- [type ChatRequest](<#ChatRequest>)
- [type ChatResponse](<#ChatResponse>)


<a name="NewHandler"></a>
## func [NewHandler](<https://github.com/contexis-cmp/contexis/blob/main/src/runtime/server/server.go#L111>)

```go
func NewHandler(root string) http.Handler
```

NewHandler constructs an http.Handler with health, readiness, version, metrics, and chat endpoints.

<a name="NewHandlerWithProvider"></a>
## func [NewHandlerWithProvider](<https://github.com/contexis-cmp/contexis/blob/main/src/runtime/server/server.go#L118>)

```go
func NewHandlerWithProvider(root string, provider runtimemodel.Provider) http.Handler
```

NewHandlerWithProvider constructs an http.Handler and injects a model Provider for inference \(used by tests and custom wiring\).

<a name="Serve"></a>
## func [Serve](<https://github.com/contexis-cmp/contexis/blob/main/src/runtime/server/server.go#L414>)

```go
func Serve(addr string) error
```

Serve starts the HTTP server and performs graceful shutdown on SIGINT/SIGTERM.

<a name="ChatRequest"></a>
## type [ChatRequest](<https://github.com/contexis-cmp/contexis/blob/main/src/runtime/server/server.go#L29-L37>)

ChatRequest is the request payload for POST /api/v1/chat.

```go
type ChatRequest struct {
    TenantID   string                 `json:"tenant_id"`
    Context    string                 `json:"context"`
    Component  string                 `json:"component"`
    Query      string                 `json:"query"`
    TopK       int                    `json:"top_k"`
    Data       map[string]interface{} `json:"data"`
    PromptFile string                 `json:"prompt_file"`
}
```

<a name="ChatResponse"></a>
## type [ChatResponse](<https://github.com/contexis-cmp/contexis/blob/main/src/runtime/server/server.go#L40-L42>)

ChatResponse is the response payload for POST /api/v1/chat.

```go
type ChatResponse struct {
    Rendered string `json:"rendered"`
}
```

# worker

```go
import "github.com/contexis-cmp/contexis/src/runtime/worker"
```

## Index

- [func Serve\(addr string\) error](<#Serve>)


<a name="Serve"></a>
## func [Serve](<https://github.com/contexis-cmp/contexis/blob/main/src/runtime/worker/server.go#L23>)

```go
func Serve(addr string) error
```

Serve starts a minimal HTTP endpoint for worker health and metrics

Generated by [gomarkdoc](<https://github.com/princjef/gomarkdoc>)
