<!-- Code generated by gomarkdoc. DO NOT EDIT -->

# context

```go
import "github.com/contexis-cmp/contexis/src/core/context"
```

Package context defines the Contexis CMP Context domain model.

A Context is a declarative specification of an AI agent: role/persona, capabilities, tool integrations, guardrails, memory behavior, and testing configuration. Contexts are authored as YAML \(\`.ctx\`\) files and validated against a JSON Schema at load time. The types in this package map 1:1 to the persisted representation and are used across the runtime and tooling.

## Index

- [type Context](<#Context>)
  - [func FromJSON\(data \[\]byte\) \(\*Context, error\)](<#FromJSON>)
  - [func New\(name, version string\) \*Context](<#New>)
  - [func \(c \*Context\) GetSHA\(\) \(string, error\)](<#Context.GetSHA>)
  - [func \(c \*Context\) ToJSON\(\) \(\[\]byte, error\)](<#Context.ToJSON>)
  - [func \(c \*Context\) Validate\(\) error](<#Context.Validate>)
- [type Guardrails](<#Guardrails>)
- [type MemoryConfig](<#MemoryConfig>)
- [type Role](<#Role>)
- [type TestingConfig](<#TestingConfig>)
- [type Tool](<#Tool>)


<a name="Context"></a>
## type [Context](<https://github.com/contexis-cmp/contexis/blob/main/src/core/context/context.go#L16-L30>)

Context represents a declarative agent specification in the CMP framework.

A Context defines the agent's name and version, role/persona with capabilities, available tools, guardrails, memory behavior, and testing configuration. Contexts are typically loaded from \`.ctx\` YAML files.

```go
type Context struct {
    Name        string `json:"name" yaml:"name"`
    Version     string `json:"version" yaml:"version"`
    Description string `json:"description,omitempty" yaml:"description,omitempty"`

    Role       Role          `json:"role" yaml:"role"`
    Tools      []Tool        `json:"tools,omitempty" yaml:"tools,omitempty"`
    Guardrails Guardrails    `json:"guardrails,omitempty" yaml:"guardrails,omitempty"`
    Memory     MemoryConfig  `json:"memory,omitempty" yaml:"memory,omitempty"`
    Testing    TestingConfig `json:"testing,omitempty" yaml:"testing,omitempty"`

    CreatedAt time.Time         `json:"created_at" yaml:"created_at"`
    UpdatedAt time.Time         `json:"updated_at" yaml:"updated_at"`
    Metadata  map[string]string `json:"metadata,omitempty" yaml:"metadata,omitempty"`
}
```

<a name="FromJSON"></a>
### func [FromJSON](<https://github.com/contexis-cmp/contexis/blob/main/src/core/context/context.go#L102>)

```go
func FromJSON(data []byte) (*Context, error)
```

FromJSON parses a Context value from JSON bytes.

<a name="New"></a>
### func [New](<https://github.com/contexis-cmp/contexis/blob/main/src/core/context/context.go#L69>)

```go
func New(name, version string) *Context
```

New creates a new Context with default values.

<details><summary>Example</summary>
<p>



```go
c := New("SupportBot", "1.0.0")
fmt.Println(c.Name, c.Version)
// Output:
// SupportBot 1.0.0
```

#### Output

```
SupportBot 1.0.0
```

</p>
</details>

<a name="Context.GetSHA"></a>
### func \(\*Context\) [GetSHA](<https://github.com/contexis-cmp/contexis/blob/main/src/core/context/context.go#L112>)

```go
func (c *Context) GetSHA() (string, error)
```

GetSHA returns a content\-addressed SHA\-256 hash of the Context, suitable for immutable versioning and provenance.

<details><summary>Example</summary>
<p>



```go
c := New("MyAgent", "0.1.0")
sha, _ := c.GetSHA()
fmt.Println(strings.HasPrefix(sha, "sha256:"))
// Output:
// true
```

#### Output

```
true
```

</p>
</details>

<a name="Context.ToJSON"></a>
### func \(\*Context\) [ToJSON](<https://github.com/contexis-cmp/contexis/blob/main/src/core/context/context.go#L97>)

```go
func (c *Context) ToJSON() ([]byte, error)
```

ToJSON converts the Context to pretty\-printed JSON bytes.

<a name="Context.Validate"></a>
### func \(\*Context\) [Validate](<https://github.com/contexis-cmp/contexis/blob/main/src/core/context/context.go#L83>)

```go
func (c *Context) Validate() error
```

Validate ensures the Context has the required fields populated.

<details><summary>Example</summary>
<p>



```go
c := New("MyAgent", "0.1.0")
c.Role.Persona = "Helpful assistant"
fmt.Println(c.Validate() == nil)
// Output:
// true
```

#### Output

```
true
```

</p>
</details>

<a name="Guardrails"></a>
## type [Guardrails](<https://github.com/contexis-cmp/contexis/blob/main/src/core/context/context.go#L47-L52>)

Guardrails define behavioral constraints for agent responses.

```go
type Guardrails struct {
    Tone        string  `json:"tone,omitempty" yaml:"tone,omitempty"`
    Format      string  `json:"format,omitempty" yaml:"format,omitempty"`
    MaxTokens   int     `json:"max_tokens,omitempty" yaml:"max_tokens,omitempty"`
    Temperature float64 `json:"temperature,omitempty" yaml:"temperature,omitempty"`
}
```

<a name="MemoryConfig"></a>
## type [MemoryConfig](<https://github.com/contexis-cmp/contexis/blob/main/src/core/context/context.go#L55-L59>)

MemoryConfig defines conversational memory behavior for an agent.

```go
type MemoryConfig struct {
    Episodic   bool   `json:"episodic" yaml:"episodic"`
    MaxHistory int    `json:"max_history" yaml:"max_history"`
    Privacy    string `json:"privacy" yaml:"privacy"`
}
```

<a name="Role"></a>
## type [Role](<https://github.com/contexis-cmp/contexis/blob/main/src/core/context/context.go#L33-L37>)

Role defines the agent persona and allowed capabilities.

```go
type Role struct {
    Persona      string   `json:"persona" yaml:"persona"`
    Capabilities []string `json:"capabilities" yaml:"capabilities"`
    Limitations  []string `json:"limitations" yaml:"limitations"`
}
```

<a name="TestingConfig"></a>
## type [TestingConfig](<https://github.com/contexis-cmp/contexis/blob/main/src/core/context/context.go#L63-L66>)

TestingConfig defines testing parameters such as drift thresholds and business rules that should hold in automated tests.

```go
type TestingConfig struct {
    DriftThreshold float64  `json:"drift_threshold" yaml:"drift_threshold"`
    BusinessRules  []string `json:"business_rules" yaml:"business_rules"`
}
```

<a name="Tool"></a>
## type [Tool](<https://github.com/contexis-cmp/contexis/blob/main/src/core/context/context.go#L40-L44>)

Tool represents an external function or integration available to the agent.

```go
type Tool struct {
    Name        string `json:"name" yaml:"name"`
    URI         string `json:"uri" yaml:"uri"`
    Description string `json:"description,omitempty" yaml:"description,omitempty"`
}
```

# memory

```go
import "github.com/contexis-cmp/contexis/src/core/memory"
```

## Index

- [type Memory](<#Memory>)
  - [func FromJSON\(data \[\]byte\) \(\*Memory, error\)](<#FromJSON>)
  - [func New\(name, version, memoryType string\) \*Memory](<#New>)
  - [func \(m \*Memory\) AddItem\(content, itemType string, metadata map\[string\]interface\{\}\)](<#Memory.AddItem>)
  - [func \(m \*Memory\) GetSHA\(\) \(string, error\)](<#Memory.GetSHA>)
  - [func \(m \*Memory\) Search\(query string, limit int\) \(\[\]MemoryItem, error\)](<#Memory.Search>)
  - [func \(m \*Memory\) ToJSON\(\) \(\[\]byte, error\)](<#Memory.ToJSON>)
  - [func \(m \*Memory\) Validate\(\) error](<#Memory.Validate>)
- [type MemoryConfig](<#MemoryConfig>)
- [type MemoryItem](<#MemoryItem>)
- [type MemorySchema](<#MemorySchema>)
- [type SchemaField](<#SchemaField>)


<a name="Memory"></a>
## type [Memory](<https://github.com/contexis-cmp/contexis/blob/main/src/core/memory/memory.go#L10-L23>)

Memory represents versioned knowledge stores in the CMP framework

```go
type Memory struct {
    Name        string `json:"name" yaml:"name"`
    Version     string `json:"version" yaml:"version"`
    Type        string `json:"type" yaml:"type"` // "vector", "episodic", "semantic"
    Description string `json:"description,omitempty" yaml:"description,omitempty"`

    Content []MemoryItem `json:"content" yaml:"content"`
    Schema  MemorySchema `json:"schema,omitempty" yaml:"schema,omitempty"`
    Config  MemoryConfig `json:"config" yaml:"config"`

    CreatedAt time.Time         `json:"created_at" yaml:"created_at"`
    UpdatedAt time.Time         `json:"updated_at" yaml:"updated_at"`
    Metadata  map[string]string `json:"metadata,omitempty" yaml:"metadata,omitempty"`
}
```

<a name="FromJSON"></a>
### func [FromJSON](<https://github.com/contexis-cmp/contexis/blob/main/src/core/memory/memory.go#L127>)

```go
func FromJSON(data []byte) (*Memory, error)
```

FromJSON creates a memory from JSON

<a name="New"></a>
### func [New](<https://github.com/contexis-cmp/contexis/blob/main/src/core/memory/memory.go#L62>)

```go
func New(name, version, memoryType string) *Memory
```

New creates a new Memory with default values

<a name="Memory.AddItem"></a>
### func \(\*Memory\) [AddItem](<https://github.com/contexis-cmp/contexis/blob/main/src/core/memory/memory.go#L80>)

```go
func (m *Memory) AddItem(content, itemType string, metadata map[string]interface{})
```

AddItem adds a new memory item

<a name="Memory.GetSHA"></a>
### func \(\*Memory\) [GetSHA](<https://github.com/contexis-cmp/contexis/blob/main/src/core/memory/memory.go#L136>)

```go
func (m *Memory) GetSHA() (string, error)
```

GetSHA returns a content\-based hash for versioning

<a name="Memory.Search"></a>
### func \(\*Memory\) [Search](<https://github.com/contexis-cmp/contexis/blob/main/src/core/memory/memory.go#L94>)

```go
func (m *Memory) Search(query string, limit int) ([]MemoryItem, error)
```

Search performs semantic search on memory content

<a name="Memory.ToJSON"></a>
### func \(\*Memory\) [ToJSON](<https://github.com/contexis-cmp/contexis/blob/main/src/core/memory/memory.go#L122>)

```go
func (m *Memory) ToJSON() ([]byte, error)
```

ToJSON converts the memory to JSON

<a name="Memory.Validate"></a>
### func \(\*Memory\) [Validate](<https://github.com/contexis-cmp/contexis/blob/main/src/core/memory/memory.go#L108>)

```go
func (m *Memory) Validate() error
```

Validate ensures the memory is properly configured

<a name="MemoryConfig"></a>
## type [MemoryConfig](<https://github.com/contexis-cmp/contexis/blob/main/src/core/memory/memory.go#L52-L59>)

MemoryConfig defines memory behavior and storage

```go
type MemoryConfig struct {
    Provider   string            `json:"provider" yaml:"provider"`     // "sqlite", "postgres", "chroma", "pinecone"
    Embeddings string            `json:"embeddings" yaml:"embeddings"` // "openai", "sentence-transformers"
    ChunkSize  int               `json:"chunk_size" yaml:"chunk_size"`
    Overlap    int               `json:"overlap" yaml:"overlap"`
    MaxTokens  int               `json:"max_tokens" yaml:"max_tokens"`
    Settings   map[string]string `json:"settings,omitempty" yaml:"settings,omitempty"`
}
```

<a name="MemoryItem"></a>
## type [MemoryItem](<https://github.com/contexis-cmp/contexis/blob/main/src/core/memory/memory.go#L26-L34>)

MemoryItem represents a single piece of knowledge

```go
type MemoryItem struct {
    ID        string                 `json:"id" yaml:"id"`
    Content   string                 `json:"content" yaml:"content"`
    Type      string                 `json:"type" yaml:"type"` // "text", "document", "conversation"
    Embedding []float64              `json:"embedding,omitempty" yaml:"embedding,omitempty"`
    Metadata  map[string]interface{} `json:"metadata,omitempty" yaml:"metadata,omitempty"`
    CreatedAt time.Time              `json:"created_at" yaml:"created_at"`
    UpdatedAt time.Time              `json:"updated_at" yaml:"updated_at"`
}
```

<a name="MemorySchema"></a>
## type [MemorySchema](<https://github.com/contexis-cmp/contexis/blob/main/src/core/memory/memory.go#L37-L41>)

MemorySchema defines the structure of memory items

```go
type MemorySchema struct {
    Fields   []SchemaField `json:"fields" yaml:"fields"`
    Required []string      `json:"required,omitempty" yaml:"required,omitempty"`
    Indexes  []string      `json:"indexes,omitempty" yaml:"indexes,omitempty"`
}
```

<a name="SchemaField"></a>
## type [SchemaField](<https://github.com/contexis-cmp/contexis/blob/main/src/core/memory/memory.go#L44-L49>)

SchemaField defines a field in the memory schema

```go
type SchemaField struct {
    Name        string `json:"name" yaml:"name"`
    Type        string `json:"type" yaml:"type"`
    Description string `json:"description,omitempty" yaml:"description,omitempty"`
    Required    bool   `json:"required" yaml:"required"`
}
```

# prompt

```go
import "github.com/contexis-cmp/contexis/src/core/prompt"
```

## Index

- [Constants](<#constants>)
- [type Prompt](<#Prompt>)
  - [func FromJSON\(data \[\]byte\) \(\*Prompt, error\)](<#FromJSON>)
  - [func New\(name, version, template string\) \*Prompt](<#New>)
  - [func \(p \*Prompt\) AddVariable\(name, varType string, required bool, description string\)](<#Prompt.AddVariable>)
  - [func \(p \*Prompt\) GetSHA\(\) \(string, error\)](<#Prompt.GetSHA>)
  - [func \(p \*Prompt\) Render\(data map\[string\]interface\{\}\) \(string, error\)](<#Prompt.Render>)
  - [func \(p \*Prompt\) ToJSON\(\) \(\[\]byte, error\)](<#Prompt.ToJSON>)
  - [func \(p \*Prompt\) Validate\(\) error](<#Prompt.Validate>)
- [type PromptConfig](<#PromptConfig>)
- [type Variable](<#Variable>)


## Constants

<a name="RAGResponseTemplate"></a>Example templates for common use cases

```go
const (
    // RAG response template
    RAGResponseTemplate = `Based on the following context, answer the user's question:

Context:
{{range .context}}
- {{.content}}
{{end}}

Question: {{.question}}

Answer:`

    // Agent conversation template
    AgentConversationTemplate = `You are {{.role.persona}}.

Your capabilities include: {{range .role.capabilities}}{{.}}, {{end}}

Your limitations: {{range .role.limitations}}{{.}}, {{end}}

Current conversation context:
{{.conversation_history}}

User: {{.user_input}}

Assistant:`

    // Workflow step template
    WorkflowStepTemplate = `Execute the following step in the workflow:

Step: {{.step_name}}
Description: {{.step_description}}

Input data: {{.input_data}}

Instructions: {{.instructions}}

Output format: {{.output_format}}

Result:`
)
```

<a name="Prompt"></a>
## type [Prompt](<https://github.com/contexis-cmp/contexis/blob/main/src/core/prompt/prompt.go#L14-L26>)

Prompt represents pure templates hydrated at runtime in the CMP framework

```go
type Prompt struct {
    Name        string `json:"name" yaml:"name"`
    Version     string `json:"version" yaml:"version"`
    Description string `json:"description,omitempty" yaml:"description,omitempty"`

    Template  string       `json:"template" yaml:"template"`
    Variables []Variable   `json:"variables,omitempty" yaml:"variables,omitempty"`
    Config    PromptConfig `json:"config" yaml:"config"`

    CreatedAt time.Time         `json:"created_at" yaml:"created_at"`
    UpdatedAt time.Time         `json:"updated_at" yaml:"updated_at"`
    Metadata  map[string]string `json:"metadata,omitempty" yaml:"metadata,omitempty"`
}
```

<a name="FromJSON"></a>
### func [FromJSON](<https://github.com/contexis-cmp/contexis/blob/main/src/core/prompt/prompt.go#L109>)

```go
func FromJSON(data []byte) (*Prompt, error)
```

FromJSON creates a prompt from JSON

<a name="New"></a>
### func [New](<https://github.com/contexis-cmp/contexis/blob/main/src/core/prompt/prompt.go#L46>)

```go
func New(name, version, template string) *Prompt
```

New creates a new Prompt with default values

<a name="Prompt.AddVariable"></a>
### func \(\*Prompt\) [AddVariable](<https://github.com/contexis-cmp/contexis/blob/main/src/core/prompt/prompt.go#L79>)

```go
func (p *Prompt) AddVariable(name, varType string, required bool, description string)
```

AddVariable adds a new template variable

<a name="Prompt.GetSHA"></a>
### func \(\*Prompt\) [GetSHA](<https://github.com/contexis-cmp/contexis/blob/main/src/core/prompt/prompt.go#L118>)

```go
func (p *Prompt) GetSHA() (string, error)
```

GetSHA returns a content\-based hash for versioning

<a name="Prompt.Render"></a>
### func \(\*Prompt\) [Render](<https://github.com/contexis-cmp/contexis/blob/main/src/core/prompt/prompt.go#L64>)

```go
func (p *Prompt) Render(data map[string]interface{}) (string, error)
```

Render hydrates the template with provided data

<a name="Prompt.ToJSON"></a>
### func \(\*Prompt\) [ToJSON](<https://github.com/contexis-cmp/contexis/blob/main/src/core/prompt/prompt.go#L104>)

```go
func (p *Prompt) ToJSON() ([]byte, error)
```

ToJSON converts the prompt to JSON

<a name="Prompt.Validate"></a>
### func \(\*Prompt\) [Validate](<https://github.com/contexis-cmp/contexis/blob/main/src/core/prompt/prompt.go#L90>)

```go
func (p *Prompt) Validate() error
```

Validate ensures the prompt is properly configured

<a name="PromptConfig"></a>
## type [PromptConfig](<https://github.com/contexis-cmp/contexis/blob/main/src/core/prompt/prompt.go#L38-L43>)

PromptConfig defines prompt behavior

```go
type PromptConfig struct {
    MaxTokens   int     `json:"max_tokens" yaml:"max_tokens"`
    Temperature float64 `json:"temperature" yaml:"temperature"`
    Format      string  `json:"format,omitempty" yaml:"format,omitempty"` // "json", "markdown", "text"
    Language    string  `json:"language,omitempty" yaml:"language,omitempty"`
}
```

<a name="Variable"></a>
## type [Variable](<https://github.com/contexis-cmp/contexis/blob/main/src/core/prompt/prompt.go#L29-L35>)

Variable defines a template variable

```go
type Variable struct {
    Name        string `json:"name" yaml:"name"`
    Type        string `json:"type" yaml:"type"` // "string", "context", "memory", "user"
    Required    bool   `json:"required" yaml:"required"`
    Description string `json:"description,omitempty" yaml:"description,omitempty"`
    Default     string `json:"default,omitempty" yaml:"default,omitempty"`
}
```

# schema

```go
import "github.com/contexis-cmp/contexis/src/core/schema"
```

Package schema provides validation utilities for Contexis context files.

It includes lightweight YAML checks and optional JSON Schema validation for \`.ctx\` files used to define agent contexts.

## Index

- [func JSONMarshal\(v interface\{\}\) \(\[\]byte, error\)](<#JSONMarshal>)
- [func ValidateContextYAML\(yamlBytes \[\]byte\) error](<#ValidateContextYAML>)


<a name="JSONMarshal"></a>
## func [JSONMarshal](<https://github.com/contexis-cmp/contexis/blob/main/src/core/schema/validator.go#L63>)

```go
func JSONMarshal(v interface{}) ([]byte, error)
```

JSONMarshal marshals any value to JSON bytes.

<a name="ValidateContextYAML"></a>
## func [ValidateContextYAML](<https://github.com/contexis-cmp/contexis/blob/main/src/core/schema/validator.go#L18>)

```go
func ValidateContextYAML(yamlBytes []byte) error
```

ValidateContextYAML performs a lightweight validation of a \`.ctx\` YAML file.

The function ensures required top\-level fields exist and have expected types. If a JSON Schema is present at \`src/core/schema/context\_schema.json\`, it validates against that schema; otherwise it falls back to basic checks.

# runtimecontext

```go
import "github.com/contexis-cmp/contexis/src/runtime/context"
```

## Index

- [func DeepMerge\(dst, src map\[string\]interface\{\}\) map\[string\]interface\{\}](<#DeepMerge>)
- [type ContextService](<#ContextService>)
  - [func NewContextService\(projectRoot string\) \*ContextService](<#NewContextService>)
  - [func \(s \*ContextService\) ReloadContext\(\_ string\) error](<#ContextService.ReloadContext>)
  - [func \(s \*ContextService\) ResolveContext\(tenantID, contextName string\) \(\*corectx.Context, error\)](<#ContextService.ResolveContext>)


<a name="DeepMerge"></a>
## func [DeepMerge](<https://github.com/contexis-cmp/contexis/blob/main/src/runtime/context/service.go#L274>)

```go
func DeepMerge(dst, src map[string]interface{}) map[string]interface{}
```

DeepMerge merges src into dst recursively. Lists are unioned by value; maps are deep\-merged; scalars override.

<a name="ContextService"></a>
## type [ContextService](<https://github.com/contexis-cmp/contexis/blob/main/src/runtime/context/service.go#L18-L22>)

ContextService is responsible for resolving, validating, and caching contexts.

```go
type ContextService struct {
    // contains filtered or unexported fields
}
```

<a name="NewContextService"></a>
### func [NewContextService](<https://github.com/contexis-cmp/contexis/blob/main/src/runtime/context/service.go#L25>)

```go
func NewContextService(projectRoot string) *ContextService
```

NewContextService creates a new ContextService instance.

<a name="ContextService.ReloadContext"></a>
### func \(\*ContextService\) [ReloadContext](<https://github.com/contexis-cmp/contexis/blob/main/src/runtime/context/service.go#L114>)

```go
func (s *ContextService) ReloadContext(_ string) error
```

ReloadContext clears the cache so subsequent calls re\-read from disk. If a path is supplied, this is currently a no\-op beyond clearing the cache.

<a name="ContextService.ResolveContext"></a>
### func \(\*ContextService\) [ResolveContext](<https://github.com/contexis-cmp/contexis/blob/main/src/runtime/context/service.go#L36>)

```go
func (s *ContextService) ResolveContext(tenantID, contextName string) (*corectx.Context, error)
```

ResolveContext loads, validates, and returns a Context for a tenant and context name. Resolution order: 1\) contexts/tenants/\<tenantID\>/\<contextName\>.ctx 2\) contexts/\<contextName\>/\*.ctx \(first .ctx file found in that directory\)

# guardrails

```go
import "github.com/contexis-cmp/contexis/src/runtime/guardrails"
```

## Index

- [func EnforceGuardrails\(ctx \*corectx.Context, response string\) \(string, error\)](<#EnforceGuardrails>)
- [func ValidateCapabilities\(ctx \*corectx.Context, requestedAction string\) error](<#ValidateCapabilities>)


<a name="EnforceGuardrails"></a>
## func [EnforceGuardrails](<https://github.com/contexis-cmp/contexis/blob/main/src/runtime/guardrails/enforcer.go#L32>)

```go
func EnforceGuardrails(ctx *corectx.Context, response string) (string, error)
```

EnforceGuardrails applies guardrail constraints to a candidate response.

It enforces:

- Response format \(json|markdown|text\)
- Token length \(MaxTokens\)

Tone and temperature are advisory and not enforced at this stage.

<details><summary>Example</summary>
<p>



```go
ctx := &corectx.Context{Guardrails: corectx.Guardrails{Format: "text", MaxTokens: 3}}
out, err := EnforceGuardrails(ctx, "one two three four five")
fmt.Println(err == nil && out == "one two three ...")
// Output:
// true
```

#### Output

```
true
```

</p>
</details>

<a name="ValidateCapabilities"></a>
## func [ValidateCapabilities](<https://github.com/contexis-cmp/contexis/blob/main/src/runtime/guardrails/enforcer.go#L13>)

```go
func ValidateCapabilities(ctx *corectx.Context, requestedAction string) error
```

ValidateCapabilities returns an error if requestedAction is not permitted by the Context's role capabilities. An empty action is treated as allowed.

<details><summary>Example</summary>
<p>



```go
ctx := &corectx.Context{Role: corectx.Role{Capabilities: []string{"search", "answer"}}}
err := ValidateCapabilities(ctx, "search")
fmt.Println(err == nil)
// Output:
// true
```

#### Output

```
true
```

</p>
</details>

# runtimememory

```go
import "github.com/contexis-cmp/contexis/src/runtime/memory"
```

## Index

- [func DerivePath\(root, component, tenantID, subpath string\) string](<#DerivePath>)
- [func LoadComponentMemoryConfig\(cfg \*Config\) error](<#LoadComponentMemoryConfig>)
- [type Config](<#Config>)
- [type MemoryStore](<#MemoryStore>)
  - [func NewStore\(cfg Config\) \(MemoryStore, error\)](<#NewStore>)
- [type SearchResult](<#SearchResult>)


<a name="DerivePath"></a>
## func [DerivePath](<https://github.com/contexis-cmp/contexis/blob/main/src/runtime/memory/service.go#L36>)

```go
func DerivePath(root, component, tenantID, subpath string) string
```

DerivePath returns a tenant\-aware path under memory/.

<a name="LoadComponentMemoryConfig"></a>
## func [LoadComponentMemoryConfig](<https://github.com/contexis-cmp/contexis/blob/main/src/runtime/memory/config.go#L12>)

```go
func LoadComponentMemoryConfig(cfg *Config) error
```

LoadComponentMemoryConfig loads memory\_config.yaml for a component if present and merges into cfg.Settings.

<a name="Config"></a>
## type [Config](<https://github.com/contexis-cmp/contexis/blob/main/src/runtime/memory/service.go#L12-L19>)

Config for memory service instantiation.

```go
type Config struct {
    Provider       string            // sqlite, episodic
    RootDir        string            // project root for file-backed stores
    ComponentName  string            // e.g., CustomerDocs, SupportBot
    EmbeddingModel string            // model identifier for vector stores
    Settings       map[string]string // provider-specific settings
    TenantID       string            // tenant isolation
}
```

<a name="MemoryStore"></a>
## type [MemoryStore](<https://github.com/contexis-cmp/contexis/blob/main/src/runtime/memory/store.go#L14-L26>)

MemoryStore defines the interface for memory providers.

```go
type MemoryStore interface {
    // IngestDocuments ingests raw text documents and returns a version identifier (e.g., memory SHA).
    IngestDocuments(ctx context.Context, documents []string) (string, error)

    // Search performs a semantic search and returns the top results.
    Search(ctx context.Context, query string, topK int) ([]SearchResult, error)

    // Optimize performs any maintenance/compaction tasks.
    Optimize(ctx context.Context, memoryVersion string) error

    // Close releases resources.
    Close() error
}
```

<a name="NewStore"></a>
### func [NewStore](<https://github.com/contexis-cmp/contexis/blob/main/src/runtime/memory/service.go#L22>)

```go
func NewStore(cfg Config) (MemoryStore, error)
```

NewStore creates a MemoryStore based on config.

<a name="SearchResult"></a>
## type [SearchResult](<https://github.com/contexis-cmp/contexis/blob/main/src/runtime/memory/store.go#L6-L11>)

SearchResult represents a single search match from a memory store.

```go
type SearchResult struct {
    ID       string                 `json:"id"`
    Content  string                 `json:"content"`
    Score    float64                `json:"score"`
    Metadata map[string]interface{} `json:"metadata,omitempty"`
}
```

# model

```go
import "github.com/contexis-cmp/contexis/src/runtime/model"
```

Package model defines the model provider abstraction used by the runtime.

Providers implement text generation over rendered prompts. A factory reads environment variables to select a concrete implementation \(e.g. Hugging Face Inference API\), or returns nil when no provider is configured.

## Index

- [type HuggingFaceAPIProvider](<#HuggingFaceAPIProvider>)
  - [func NewHuggingFaceAPIProviderFromEnv\(\) \(\*HuggingFaceAPIProvider, error\)](<#NewHuggingFaceAPIProviderFromEnv>)
  - [func \(p \*HuggingFaceAPIProvider\) Generate\(ctx context.Context, input string, params Params\) \(string, error\)](<#HuggingFaceAPIProvider.Generate>)
- [type Params](<#Params>)
- [type Provider](<#Provider>)
  - [func FromEnv\(\) \(Provider, error\)](<#FromEnv>)


<a name="HuggingFaceAPIProvider"></a>
## type [HuggingFaceAPIProvider](<https://github.com/contexis-cmp/contexis/blob/main/src/runtime/model/hf_provider.go#L14-L19>)

HuggingFaceAPIProvider calls the HF Inference API for text generation.

```go
type HuggingFaceAPIProvider struct {
    // contains filtered or unexported fields
}
```

<a name="NewHuggingFaceAPIProviderFromEnv"></a>
### func [NewHuggingFaceAPIProviderFromEnv](<https://github.com/contexis-cmp/contexis/blob/main/src/runtime/model/hf_provider.go#L21>)

```go
func NewHuggingFaceAPIProviderFromEnv() (*HuggingFaceAPIProvider, error)
```



<a name="HuggingFaceAPIProvider.Generate"></a>
### func \(\*HuggingFaceAPIProvider\) [Generate](<https://github.com/contexis-cmp/contexis/blob/main/src/runtime/model/hf_provider.go#L48>)

```go
func (p *HuggingFaceAPIProvider) Generate(ctx context.Context, input string, params Params) (string, error)
```



<a name="Params"></a>
## type [Params](<https://github.com/contexis-cmp/contexis/blob/main/src/runtime/model/provider.go#L7-L12>)

Params defines model generation parameters that influence decoding. Fields may be ignored by providers that do not support them.

```go
type Params struct {
    Temperature   float64 // Sampling temperature
    TopP          float64 // Nucleus sampling probability
    MaxNewTokens  int     // Maximum number of new tokens to generate
    RepetitionPen float64 // Repetition penalty
}
```

<details><summary>Example</summary>
<p>



```go
p := Params{Temperature: 0.2, TopP: 0.9, MaxNewTokens: 64, RepetitionPen: 1.1}
fmt.Println(p.MaxNewTokens)
// Output:
// 64
```

#### Output

```
64
```

</p>
</details>

<a name="Provider"></a>
## type [Provider](<https://github.com/contexis-cmp/contexis/blob/main/src/runtime/model/provider.go#L16-L18>)

Provider defines an inference provider capable of generating text based on a rendered prompt and parameter set.

```go
type Provider interface {
    Generate(ctx context.Context, input string, params Params) (string, error)
}
```

<a name="FromEnv"></a>
### func [FromEnv](<https://github.com/contexis-cmp/contexis/blob/main/src/runtime/model/factory.go#L8>)

```go
func FromEnv() (Provider, error)
```

FromEnv returns a Provider when environment variables are configured, or nil when no provider is configured. Supported variables:

- HF\_TOKEN, HF\_MODEL\_ID\[, HF\_ENDPOINT\] for Hugging Face Inference API.

<details><summary>Example</summary>
<p>



```go
prov, _ := FromEnv()
fmt.Println(prov == nil || prov != nil)
// Output:
// true
```

#### Output

```
true
```

</p>
</details>

# runtimeprompt

```go
import "github.com/contexis-cmp/contexis/src/runtime/prompt"
```

## Index

- [func OptimizeTokens\(content string, maxTokens int\) string](<#OptimizeTokens>)
- [func ValidateFormat\(format, response string\) error](<#ValidateFormat>)
- [type Engine](<#Engine>)
  - [func NewEngine\(projectRoot string\) \*Engine](<#NewEngine>)
  - [func \(e \*Engine\) RenderFile\(component string, relPath string, data map\[string\]interface\{\}\) \(string, error\)](<#Engine.RenderFile>)


<a name="OptimizeTokens"></a>
## func [OptimizeTokens](<https://github.com/contexis-cmp/contexis/blob/main/src/runtime/prompt/engine.go#L96>)

```go
func OptimizeTokens(content string, maxTokens int) string
```

OptimizeTokens trims content to at most maxTokens using a naive whitespace tokenization.

<details><summary>Example</summary>
<p>



```go
out := OptimizeTokens("one two three four five", 3)
fmt.Println(out)
// Output:
// one two three ...
```

#### Output

```
one two three ...
```

</p>
</details>

<a name="ValidateFormat"></a>
## func [ValidateFormat](<https://github.com/contexis-cmp/contexis/blob/main/src/runtime/prompt/engine.go#L109>)

```go
func ValidateFormat(format, response string) error
```

ValidateFormat validates response against expected format. If format == "json", checks JSON. If format == "markdown", ensures non\-empty and at least one newline.

<details><summary>Example</summary>
<p>



```go
err := ValidateFormat("text", "hello")
fmt.Println(err == nil)
// Output:
// true
```

#### Output

```
true
```

</p>
</details>

<a name="Engine"></a>
## type [Engine](<https://github.com/contexis-cmp/contexis/blob/main/src/runtime/prompt/engine.go#L14-L18>)

Engine loads, compiles, caches, renders, and validates prompt templates.

```go
type Engine struct {
    // contains filtered or unexported fields
}
```

<a name="NewEngine"></a>
### func [NewEngine](<https://github.com/contexis-cmp/contexis/blob/main/src/runtime/prompt/engine.go#L20>)

```go
func NewEngine(projectRoot string) *Engine
```



<a name="Engine.RenderFile"></a>
### func \(\*Engine\) [RenderFile](<https://github.com/contexis-cmp/contexis/blob/main/src/runtime/prompt/engine.go#L25>)

```go
func (e *Engine) RenderFile(component string, relPath string, data map[string]interface{}) (string, error)
```

RenderFile renders a template file in prompts/\<component\>/... with the provided data.

<details><summary>Example</summary>
<p>



```go
eng := NewEngine(".")
// This example assumes a simple prompt exists; we demonstrate API usage only.
_, err := eng.RenderFile("SupportBot", "agent_response.md", map[string]interface{}{"UserQuery": "hello"})
fmt.Println(err == nil || err != nil)
// Output:
// true
```

#### Output

```
true
```

</p>
</details>

# security

```go
import "github.com/contexis-cmp/contexis/src/runtime/security"
```

## Index

- [Variables](<#variables>)
- [func CheckPermission\(p \*Principal, r Resource, a Action\) bool](<#CheckPermission>)
- [func DecryptGCM\(key, data \[\]byte\) \(\[\]byte, error\)](<#DecryptGCM>)
- [func DetectPII\(s string\) bool](<#DetectPII>)
- [func EncryptGCM\(key, plaintext \[\]byte\) \(\[\]byte, error\)](<#EncryptGCM>)
- [func ExtractIP\(r \*http.Request\) string](<#ExtractIP>)
- [func HasScope\(p \*Principal, scope string\) bool](<#HasScope>)
- [func RedactPII\(s string\) string](<#RedactPII>)
- [func RetryAfter\(\) string](<#RetryAfter>)
- [func SanitizeUserInput\(text string\) string](<#SanitizeUserInput>)
- [func WithPrincipal\(ctx context.Context, p \*Principal\) context.Context](<#WithPrincipal>)
- [type APIKey](<#APIKey>)
- [type APIKeyStore](<#APIKeyStore>)
  - [func NewAPIKeyStoreFromEnv\(\) \*APIKeyStore](<#NewAPIKeyStoreFromEnv>)
  - [func \(s \*APIKeyStore\) Authenticate\(r \*http.Request\) \(\*Principal, error\)](<#APIKeyStore.Authenticate>)
- [type Action](<#Action>)
- [type AuditEvent](<#AuditEvent>)
- [type AuditSink](<#AuditSink>)
- [type Auditor](<#Auditor>)
  - [func NewAuditor\(sink AuditSink\) \*Auditor](<#NewAuditor>)
  - [func \(a \*Auditor\) Record\(ctx context.Context, ev AuditEvent\)](<#Auditor.Record>)
- [type EnvKeyProvider](<#EnvKeyProvider>)
  - [func \(EnvKeyProvider\) GetKey\(tenantID string\) \(\[\]byte, error\)](<#EnvKeyProvider.GetKey>)
- [type JSONFileSink](<#JSONFileSink>)
  - [func NewJSONFileSink\(path string\) \*JSONFileSink](<#NewJSONFileSink>)
  - [func \(s \*JSONFileSink\) Write\(e AuditEvent\) error](<#JSONFileSink.Write>)
- [type KeyProvider](<#KeyProvider>)
- [type LimiterKey](<#LimiterKey>)
- [type Policy](<#Policy>)
  - [func DefaultPolicy\(\) Policy](<#DefaultPolicy>)
  - [func \(p Policy\) MergeEnv\(\) Policy](<#Policy.MergeEnv>)
  - [func \(p Policy\) RequiresOutOfBand\(action string\) bool](<#Policy.RequiresOutOfBand>)
- [type Principal](<#Principal>)
  - [func FromPrincipal\(ctx context.Context\) \(\*Principal, bool\)](<#FromPrincipal>)
- [type PromptRisk](<#PromptRisk>)
  - [func ClassifyPromptRisk\(text string, extras ...string\) PromptRisk](<#ClassifyPromptRisk>)
- [type RateLimiter](<#RateLimiter>)
  - [func NewRateLimiter\(r rate.Limit, b int\) \*RateLimiter](<#NewRateLimiter>)
  - [func \(rl \*RateLimiter\) Allow\(k LimiterKey, perMinuteOverride int\) bool](<#RateLimiter.Allow>)
- [type Resource](<#Resource>)


## Variables

<a name="PromptInjectionDetections"></a>

```go
var (
    PromptInjectionDetections = prometheus.NewCounter(prometheus.CounterOpts{
        Name: "cmp_security_prompt_injection_detections_total",
        Help: "Total number of detected potential prompt injection attempts.",
    })
    PolicyViolations = prometheus.NewCounter(prometheus.CounterOpts{
        Name: "cmp_security_policy_violations_total",
        Help: "Total number of responses blocked due to policy violations.",
    })
    BlockedResponses = prometheus.NewCounter(prometheus.CounterOpts{
        Name: "cmp_security_blocked_responses_total",
        Help: "Total number of blocked responses.",
    })
)
```

<a name="CheckPermission"></a>
## func [CheckPermission](<https://github.com/contexis-cmp/contexis/blob/main/src/runtime/security/rbac.go#L23>)

```go
func CheckPermission(p *Principal, r Resource, a Action) bool
```

CheckPermission validates if principal has permission on resource

<a name="DecryptGCM"></a>
## func [DecryptGCM](<https://github.com/contexis-cmp/contexis/blob/main/src/runtime/security/crypto.go#L64>)

```go
func DecryptGCM(key, data []byte) ([]byte, error)
```

DecryptGCM decrypts data produced by EncryptGCM

<a name="DetectPII"></a>
## func [DetectPII](<https://github.com/contexis-cmp/contexis/blob/main/src/runtime/security/prompt_guard.go#L69>)

```go
func DetectPII(s string) bool
```

DetectPII returns true if content likely contains PII

<a name="EncryptGCM"></a>
## func [EncryptGCM](<https://github.com/contexis-cmp/contexis/blob/main/src/runtime/security/crypto.go#L43>)

```go
func EncryptGCM(key, plaintext []byte) ([]byte, error)
```

EncryptGCM encrypts plaintext with AES\-GCM using the provided key

<a name="ExtractIP"></a>
## func [ExtractIP](<https://github.com/contexis-cmp/contexis/blob/main/src/runtime/security/ratelimit.go#L56>)

```go
func ExtractIP(r *http.Request) string
```

ExtractIP returns the remote IP from request

<a name="HasScope"></a>
## func [HasScope](<https://github.com/contexis-cmp/contexis/blob/main/src/runtime/security/auth.go#L156>)

```go
func HasScope(p *Principal, scope string) bool
```

HasScope returns true if the principal has the given scope

<a name="RedactPII"></a>
## func [RedactPII](<https://github.com/contexis-cmp/contexis/blob/main/src/runtime/security/prompt_guard.go#L77>)

```go
func RedactPII(s string) string
```

RedactPII replaces likely PII with placeholders

<a name="RetryAfter"></a>
## func [RetryAfter](<https://github.com/contexis-cmp/contexis/blob/main/src/runtime/security/ratelimit.go#L105>)

```go
func RetryAfter() string
```

Retry\-After calculation helper \(1 second default\)

<a name="SanitizeUserInput"></a>
## func [SanitizeUserInput](<https://github.com/contexis-cmp/contexis/blob/main/src/runtime/security/prompt_guard.go#L50>)

```go
func SanitizeUserInput(text string) string
```

SanitizeUserInput strips or neutralizes model\-directed instructions in user\-provided text

<a name="WithPrincipal"></a>
## func [WithPrincipal](<https://github.com/contexis-cmp/contexis/blob/main/src/runtime/security/auth.go#L145>)

```go
func WithPrincipal(ctx context.Context, p *Principal) context.Context
```

WithPrincipal stores the principal in context

<a name="APIKey"></a>
## type [APIKey](<https://github.com/contexis-cmp/contexis/blob/main/src/runtime/security/auth.go#L23-L29>)

APIKey represents an API key entry in the keystore

```go
type APIKey struct {
    KeyID     string   `json:"key_id"`
    Hash      string   `json:"hash"`       // hex-encoded SHA-256 of the token
    TenantID  string   `json:"tenant_id"`  // associated tenant
    Scopes    []string `json:"scopes"`     // permissions like "chat:invoke", "context:read"
    RateLimit int      `json:"rate_limit"` // requests per minute (optional)
}
```

<a name="APIKeyStore"></a>
## type [APIKeyStore](<https://github.com/contexis-cmp/contexis/blob/main/src/runtime/security/auth.go#L32-L36>)

APIKeyStore provides lookup for API keys

```go
type APIKeyStore struct {
    // contains filtered or unexported fields
}
```

<a name="NewAPIKeyStoreFromEnv"></a>
### func [NewAPIKeyStoreFromEnv](<https://github.com/contexis-cmp/contexis/blob/main/src/runtime/security/auth.go#L41>)

```go
func NewAPIKeyStoreFromEnv() *APIKeyStore
```

NewAPIKeyStoreFromEnv loads keys from env. Supports two formats: 1\) CMP\_API\_KEYS as JSON array of APIKey 2\) CMP\_API\_TOKENS as comma\-separated list of "token@tenant:scope1|scope2" \(for local dev\)

<a name="APIKeyStore.Authenticate"></a>
### func \(\*APIKeyStore\) [Authenticate](<https://github.com/contexis-cmp/contexis/blob/main/src/runtime/security/auth.go#L120>)

```go
func (s *APIKeyStore) Authenticate(r *http.Request) (*Principal, error)
```

Authenticate extracts the Bearer token and verifies it against the store

<a name="Action"></a>
## type [Action](<https://github.com/contexis-cmp/contexis/blob/main/src/runtime/security/rbac.go#L13>)

Action is an operation on a resource

```go
type Action string
```

<a name="ActionRead"></a>

```go
const (
    ActionRead    Action = "read"
    ActionWrite   Action = "write"
    ActionExecute Action = "execute"
    ActionAdmin   Action = "admin"
)
```

<a name="AuditEvent"></a>
## type [AuditEvent](<https://github.com/contexis-cmp/contexis/blob/main/src/runtime/security/audit.go#L14-L24>)

AuditEvent represents a compliance\-grade audit record

```go
type AuditEvent struct {
    Timestamp  time.Time              `json:"timestamp"`
    RequestID  string                 `json:"request_id"`
    TenantID   string                 `json:"tenant_id"`
    ActorKeyID string                 `json:"actor_key_id"`
    Action     string                 `json:"action"`
    Resource   string                 `json:"resource"`
    Result     string                 `json:"result"` // allowed|denied|error|success|failure
    Reason     string                 `json:"reason,omitempty"`
    Attributes map[string]interface{} `json:"attributes,omitempty"`
}
```

<a name="AuditSink"></a>
## type [AuditSink](<https://github.com/contexis-cmp/contexis/blob/main/src/runtime/security/audit.go#L27-L29>)

AuditSink writes audit events to durable storage

```go
type AuditSink interface {
    Write(AuditEvent) error
}
```

<a name="Auditor"></a>
## type [Auditor](<https://github.com/contexis-cmp/contexis/blob/main/src/runtime/security/audit.go#L56-L58>)

Auditor routes audit events to both structured logs and sink

```go
type Auditor struct {
    // contains filtered or unexported fields
}
```

<a name="NewAuditor"></a>
### func [NewAuditor](<https://github.com/contexis-cmp/contexis/blob/main/src/runtime/security/audit.go#L60>)

```go
func NewAuditor(sink AuditSink) *Auditor
```



<a name="Auditor.Record"></a>
### func \(\*Auditor\) [Record](<https://github.com/contexis-cmp/contexis/blob/main/src/runtime/security/audit.go#L62>)

```go
func (a *Auditor) Record(ctx context.Context, ev AuditEvent)
```



<a name="EnvKeyProvider"></a>
## type [EnvKeyProvider](<https://github.com/contexis-cmp/contexis/blob/main/src/runtime/security/crypto.go#L20>)

EnvKeyProvider loads key material from environment variables CMP\_EPISODIC\_KEY \(hex/base64 not required here: expect 32\-byte raw via env or we derive from sha256\)

```go
type EnvKeyProvider struct{}
```

<a name="EnvKeyProvider.GetKey"></a>
### func \(EnvKeyProvider\) [GetKey](<https://github.com/contexis-cmp/contexis/blob/main/src/runtime/security/crypto.go#L22>)

```go
func (EnvKeyProvider) GetKey(tenantID string) ([]byte, error)
```



<a name="JSONFileSink"></a>
## type [JSONFileSink](<https://github.com/contexis-cmp/contexis/blob/main/src/runtime/security/audit.go#L32-L35>)

JSONFileSink appends events to a local JSONL file \(dev only\)

```go
type JSONFileSink struct {
    // contains filtered or unexported fields
}
```

<a name="NewJSONFileSink"></a>
### func [NewJSONFileSink](<https://github.com/contexis-cmp/contexis/blob/main/src/runtime/security/audit.go#L37>)

```go
func NewJSONFileSink(path string) *JSONFileSink
```



<a name="JSONFileSink.Write"></a>
### func \(\*JSONFileSink\) [Write](<https://github.com/contexis-cmp/contexis/blob/main/src/runtime/security/audit.go#L39>)

```go
func (s *JSONFileSink) Write(e AuditEvent) error
```



<a name="KeyProvider"></a>
## type [KeyProvider](<https://github.com/contexis-cmp/contexis/blob/main/src/runtime/security/crypto.go#L13-L16>)

KeyProvider abstracts encryption key retrieval \(per\-tenant\)

```go
type KeyProvider interface {
    // GetKey returns a 32-byte key for AES-256
    GetKey(tenantID string) ([]byte, error)
}
```

<a name="LimiterKey"></a>
## type [LimiterKey](<https://github.com/contexis-cmp/contexis/blob/main/src/runtime/security/ratelimit.go#L13-L17>)

LimiterKey identifies a limiter bucket

```go
type LimiterKey struct {
    APIKeyID string
    TenantID string
    IP       string
}
```

<a name="Policy"></a>
## type [Policy](<https://github.com/contexis-cmp/contexis/blob/main/src/runtime/security/policy.go#L9-L13>)

Policy defines action gating requirements for high\-risk operations Example: map action \-\> requires\_out\_of\_band\_confirmation

```go
type Policy struct {
    RequireOOB          map[string]bool
    NoUnsupportedClaims bool   // if true, response must cite sources when memory results are used
    PIIMode             string // off|redact|block
}
```

<a name="DefaultPolicy"></a>
### func [DefaultPolicy](<https://github.com/contexis-cmp/contexis/blob/main/src/runtime/security/policy.go#L15>)

```go
func DefaultPolicy() Policy
```



<a name="Policy.MergeEnv"></a>
### func \(Policy\) [MergeEnv](<https://github.com/contexis-cmp/contexis/blob/main/src/runtime/security/policy.go#L32>)

```go
func (p Policy) MergeEnv() Policy
```

MergeEnv allows overriding policy using environment variables CMP\_OOB\_REQUIRED\_ACTIONS: comma\-separated list of actions requiring OOB \(e.g., "data\_change,account\_action,payment"\) CMP\_PII\_MODE: one of off|redact|block

<a name="Policy.RequiresOutOfBand"></a>
### func \(Policy\) [RequiresOutOfBand](<https://github.com/contexis-cmp/contexis/blob/main/src/runtime/security/policy.go#L27>)

```go
func (p Policy) RequiresOutOfBand(action string) bool
```

RequiresOutOfBand returns true if an action requires external confirmation

<a name="Principal"></a>
## type [Principal](<https://github.com/contexis-cmp/contexis/blob/main/src/runtime/security/auth.go#L16-L20>)

Principal represents an authenticated caller

```go
type Principal struct {
    KeyID    string
    TenantID string
    Scopes   []string
}
```

<a name="FromPrincipal"></a>
### func [FromPrincipal](<https://github.com/contexis-cmp/contexis/blob/main/src/runtime/security/auth.go#L150>)

```go
func FromPrincipal(ctx context.Context) (*Principal, bool)
```

FromPrincipal retrieves the principal from context

<a name="PromptRisk"></a>
## type [PromptRisk](<https://github.com/contexis-cmp/contexis/blob/main/src/runtime/security/prompt_guard.go#L9>)

PromptRisk represents a simple risk classification for inputs

```go
type PromptRisk string
```

<a name="RiskLow"></a>

```go
const (
    RiskLow    PromptRisk = "low"
    RiskMedium PromptRisk = "medium"
    RiskHigh   PromptRisk = "high"
)
```

<a name="ClassifyPromptRisk"></a>
### func [ClassifyPromptRisk](<https://github.com/contexis-cmp/contexis/blob/main/src/runtime/security/prompt_guard.go#L31>)

```go
func ClassifyPromptRisk(text string, extras ...string) PromptRisk
```

ClassifyPromptRisk applies simple heuristics to detect likely injection attempts

<a name="RateLimiter"></a>
## type [RateLimiter](<https://github.com/contexis-cmp/contexis/blob/main/src/runtime/security/ratelimit.go#L20-L25>)

RateLimiter provides token\-bucket rate limiting across multiple dimensions

```go
type RateLimiter struct {
    // contains filtered or unexported fields
}
```

<a name="NewRateLimiter"></a>
### func [NewRateLimiter](<https://github.com/contexis-cmp/contexis/blob/main/src/runtime/security/ratelimit.go#L27>)

```go
func NewRateLimiter(r rate.Limit, b int) *RateLimiter
```



<a name="RateLimiter.Allow"></a>
### func \(\*RateLimiter\) [Allow](<https://github.com/contexis-cmp/contexis/blob/main/src/runtime/security/ratelimit.go#L35>)

```go
func (rl *RateLimiter) Allow(k LimiterKey, perMinuteOverride int) bool
```



<a name="Resource"></a>
## type [Resource](<https://github.com/contexis-cmp/contexis/blob/main/src/runtime/security/rbac.go#L6-L10>)

Resource represents a protected resource

```go
type Resource struct {
    Type   string // e.g., context, memory, prompt, tool, metrics
    Name   string // component or identifier
    Tenant string // tenant scope
}
```

# server

```go
import "github.com/contexis-cmp/contexis/src/runtime/server"
```

Package server exposes the HTTP runtime for the Contexis CMP framework.

It wires health/readiness/version/metrics endpoints and the chat API \(POST /api/v1/chat\), integrating context resolution, memory search, prompt rendering, optional model inference, and optional security controls such as authentication, RBAC, rate limiting, prompt\-injection and PII policies.

## Index

- [func NewHandler\(root string\) http.Handler](<#NewHandler>)
- [func NewHandlerWithProvider\(root string, provider runtimemodel.Provider\) http.Handler](<#NewHandlerWithProvider>)
- [func Serve\(addr string\) error](<#Serve>)
- [type ChatRequest](<#ChatRequest>)
- [type ChatResponse](<#ChatResponse>)


<a name="NewHandler"></a>
## func [NewHandler](<https://github.com/contexis-cmp/contexis/blob/main/src/runtime/server/server.go#L111>)

```go
func NewHandler(root string) http.Handler
```

NewHandler constructs an http.Handler with health, readiness, version, metrics, and chat endpoints.

<a name="NewHandlerWithProvider"></a>
## func [NewHandlerWithProvider](<https://github.com/contexis-cmp/contexis/blob/main/src/runtime/server/server.go#L118>)

```go
func NewHandlerWithProvider(root string, provider runtimemodel.Provider) http.Handler
```

NewHandlerWithProvider constructs an http.Handler and injects a model Provider for inference \(used by tests and custom wiring\).

<a name="Serve"></a>
## func [Serve](<https://github.com/contexis-cmp/contexis/blob/main/src/runtime/server/server.go#L414>)

```go
func Serve(addr string) error
```

Serve starts the HTTP server and performs graceful shutdown on SIGINT/SIGTERM.

<a name="ChatRequest"></a>
## type [ChatRequest](<https://github.com/contexis-cmp/contexis/blob/main/src/runtime/server/server.go#L29-L37>)

ChatRequest is the request payload for POST /api/v1/chat.

```go
type ChatRequest struct {
    TenantID   string                 `json:"tenant_id"`
    Context    string                 `json:"context"`
    Component  string                 `json:"component"`
    Query      string                 `json:"query"`
    TopK       int                    `json:"top_k"`
    Data       map[string]interface{} `json:"data"`
    PromptFile string                 `json:"prompt_file"`
}
```

<a name="ChatResponse"></a>
## type [ChatResponse](<https://github.com/contexis-cmp/contexis/blob/main/src/runtime/server/server.go#L40-L42>)

ChatResponse is the response payload for POST /api/v1/chat.

```go
type ChatResponse struct {
    Rendered string `json:"rendered"`
}
```

# worker

```go
import "github.com/contexis-cmp/contexis/src/runtime/worker"
```

## Index

- [func Serve\(addr string\) error](<#Serve>)


<a name="Serve"></a>
## func [Serve](<https://github.com/contexis-cmp/contexis/blob/main/src/runtime/worker/server.go#L23>)

```go
func Serve(addr string) error
```

Serve starts a minimal HTTP endpoint for worker health and metrics

# registry

```go
import "github.com/contexis-cmp/contexis/src/plugins/registry"
```

Package registry provides discovery and lifecycle management for Contexis plugins.

Plugins are declared with a \`plugin.json\` manifest under \`plugins/\<name\>/\` and can advertise capabilities \(e.g., memory backends, tools, providers\). The Registry scans, installs, and removes plugin packages at runtime or via CLI.

## Index

- [func IsKnownCapability\(cap string\) bool](<#IsKnownCapability>)
- [func ListCapabilities\(\) \[\]string](<#ListCapabilities>)
- [type Manifest](<#Manifest>)
- [type Plugin](<#Plugin>)
- [type Registry](<#Registry>)
  - [func NewRegistry\(root string\) \*Registry](<#NewRegistry>)
  - [func \(r \*Registry\) Info\(name string\) \(\*Plugin, error\)](<#Registry.Info>)
  - [func \(r \*Registry\) Install\(src string\) \(Plugin, error\)](<#Registry.Install>)
  - [func \(r \*Registry\) InstallRemote\(src string\) \(Plugin, error\)](<#Registry.InstallRemote>)
  - [func \(r \*Registry\) List\(\) \(\[\]Plugin, error\)](<#Registry.List>)
  - [func \(r \*Registry\) Remove\(name string\) error](<#Registry.Remove>)


<a name="IsKnownCapability"></a>
## func [IsKnownCapability](<https://github.com/contexis-cmp/contexis/blob/main/src/plugins/registry/capability_registry.go#L24>)

```go
func IsKnownCapability(cap string) bool
```

IsKnownCapability returns true if cap is in the registry.

<a name="ListCapabilities"></a>
## func [ListCapabilities](<https://github.com/contexis-cmp/contexis/blob/main/src/plugins/registry/capability_registry.go#L30>)

```go
func ListCapabilities() []string
```

ListCapabilities returns the known capability keys.

<a name="Manifest"></a>
## type [Manifest](<https://github.com/contexis-cmp/contexis/blob/main/src/plugins/registry/registry.go#L26-L33>)

Manifest describes a plugin package.

The manifest is stored at \`plugins/\<name\>/plugin.json\` and controls discoverability and capability declaration. Example:

```
{
  "name": "re_ranker",
  "version": "0.1.0",
  "description": "Reranking component for RAG",
  "capabilities": ["memory:rerank"],
  "compatibility": {"cmp_min": "0.1.0"}
}
```

```go
type Manifest struct {
    Name          string            `json:"name"`
    Version       string            `json:"version"`
    Description   string            `json:"description"`
    Capabilities  []string          `json:"capabilities"`
    Compatibility map[string]string `json:"compatibility"`
    Signature     string            `json:"signature,omitempty"` // optional detached signature (hex/base64)
}
```

<a name="Plugin"></a>
## type [Plugin](<https://github.com/contexis-cmp/contexis/blob/main/src/plugins/registry/registry.go#L36-L39>)

Plugin represents a discovered plugin on disk.

```go
type Plugin struct {
    Path     string
    Manifest Manifest
}
```

<a name="Registry"></a>
## type [Registry](<https://github.com/contexis-cmp/contexis/blob/main/src/plugins/registry/registry.go#L42-L44>)

Registry loads and manages plugins rooted at a project directory.

```go
type Registry struct {
    // contains filtered or unexported fields
}
```

<a name="NewRegistry"></a>
### func [NewRegistry](<https://github.com/contexis-cmp/contexis/blob/main/src/plugins/registry/registry.go#L47>)

```go
func NewRegistry(root string) *Registry
```

NewRegistry creates a new Registry reading from \`\<root\>/plugins\`.

<details><summary>Example</summary>
<p>



```go
r := NewRegistry(".")
list, err := r.List()
fmt.Println(err == nil && (len(list) >= 0))
// Output:
// true
```

#### Output

```
true
```

</p>
</details>

<a name="Registry.Info"></a>
### func \(\*Registry\) [Info](<https://github.com/contexis-cmp/contexis/blob/main/src/plugins/registry/registry.go#L86>)

```go
func (r *Registry) Info(name string) (*Plugin, error)
```

Info returns a single plugin manifest by name.

<details><summary>Example</summary>
<p>



```go
r := NewRegistry(".")
_, err := r.Info("nonexistent")
fmt.Println(err != nil)
// Output:
// true
```

#### Output

```
true
```

</p>
</details>

<a name="Registry.Install"></a>
### func \(\*Registry\) [Install](<https://github.com/contexis-cmp/contexis/blob/main/src/plugins/registry/registry.go#L100>)

```go
func (r *Registry) Install(src string) (Plugin, error)
```

Install copies a plugin directory from src into \`plugins/\<name\>\`.

<a name="Registry.InstallRemote"></a>
### func \(\*Registry\) [InstallRemote](<https://github.com/contexis-cmp/contexis/blob/main/src/plugins/registry/remote.go#L20>)

```go
func (r *Registry) InstallRemote(src string) (Plugin, error)
```

InstallRemote fetches a plugin from a URL or Git repo and installs it. Supported sources: \- HTTPS zip archive URL \(must contain plugin.json at root or in a top\-level folder\) \- Git repo URL \(requires git installed\); optional ref via \#ref

<a name="Registry.List"></a>
### func \(\*Registry\) [List](<https://github.com/contexis-cmp/contexis/blob/main/src/plugins/registry/registry.go#L52>)

```go
func (r *Registry) List() ([]Plugin, error)
```

List scans the plugins directory and returns parsed plugin manifests.

<a name="Registry.Remove"></a>
### func \(\*Registry\) [Remove](<https://github.com/contexis-cmp/contexis/blob/main/src/plugins/registry/registry.go#L130>)

```go
func (r *Registry) Remove(name string) error
```

Remove deletes \`plugins/\<name\>\` recursively.

Generated by [gomarkdoc](<https://github.com/princjef/gomarkdoc>)
